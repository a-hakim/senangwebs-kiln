!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.SWK=t():e.SWK=t()}(this,()=>(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},t={};e.d(t,{default:()=>Un});var n={BOX:"box",SPHERE:"sphere",CYLINDER:"cylinder",CONE:"cone",TORUS:"torus",PLANE:"plane",PYRAMID:"pyramid",TORUS_KNOT:"torusknot",TETRAHEDRON:"tetrahedron",OCTAHEDRON:"octahedron",ICOSAHEDRON:"icosahedron",DODECAHEDRON:"dodecahedron",TEXT:"text"},r={TRANSLATE:"translate",ROTATE:"rotate",SCALE:"scale"},o={PERSPECTIVE:"perspective",ORTHOGRAPHIC:"orthographic"},i=[.5,.2,.1,.05,.025,.01,0],a={VIEWPORT_BG:14870768,GRID_CENTER:4543852,GRID_LINES:9478585,OUTLINE:1911101,SHAPE_DEFAULT:29552},s=20,c=20,u={AMBIENT_INTENSITY:.7,AMBIENT_COLOR:16777215,DIRECTIONAL_INTENSITY:.9,DIRECTIONAL_COLOR:16777215,DIRECTIONAL_POSITION:[5,10,5]},l=75,p=.1,f=1e3,h=[5,5,5];function y(e,t){if(e){if("string"==typeof e)return d(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(e,t):void 0}}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function v(e){return v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},v(e)}function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function b(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=v(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=v(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==v(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function g(e,t){var n=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach(function(t){b(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},e);return w(e)&&w(t)&&Object.keys(t).forEach(function(r){w(t[r])&&r in e?n[r]=g(e[r],t[r]):Object.assign(n,b({},r,t[r]))}),n}function w(e){return e&&"object"===v(e)&&!Array.isArray(e)}function k(e,t){var n=document.createElement("a");n.href=URL.createObjectURL(e),n.download=t,n.click(),URL.revokeObjectURL(n.href)}function S(){return Date.now()}function O(e){var t={},n=e.dataset,r=function(){if(o.startsWith("swk")){var e=o.replace("swk","").replace(/^./,function(e){return e.toLowerCase()});e=e.replace(/([A-Z])/g,function(t,n,r){for(var o=e.substring(0,r),i=0,a=["ui","grid","camera","history","viewport","transform","lighting"];i<a.length;i++){var s=a[i];if(o.toLowerCase()===s)return"."+n.toLowerCase()}return n.toLowerCase()});var r,i=n[o];r="true"===i||"false"!==i&&(i.includes(",")?i.split(",").map(function(e){var t=e.trim();return isNaN(t)?t:parseFloat(t)}):isNaN(i)||""===i?i:parseFloat(i)),function(e,t,n){var r,o=t.split("."),i=o.pop(),a=e,s=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=y(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}(o);try{for(s.s();!(r=s.n()).done;){var c=r.value;c in a||(a[c]={}),a=a[c]}}catch(e){s.e(e)}finally{s.f()}a[i]=n}(t,e,r)}};for(var o in n)r();return t}function E(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function j(e,t,n){return(t=x(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function T(e){return T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},T(e)}function C(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=R(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function P(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,x(r.key),r)}}function x(e){var t=function(e,t){if("object"!=T(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=T(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==T(t)?t:t+""}function M(e){return function(e){if(Array.isArray(e))return A(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||R(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function R(e,t){if(e){if("string"==typeof e)return A(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?A(e,t):void 0}}function A(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var L={container:null,width:"100%",height:"100%",viewportBackground:"#".concat(a.VIEWPORT_BG.toString(16).padStart(6,"0")),outlineColor:"#".concat(a.OUTLINE.toString(16).padStart(6,"0")),outlineThickness:.04,grid:{show:!0,size:s,divisions:c,centerColor:"#".concat(a.GRID_CENTER.toString(16).padStart(6,"0")),linesColor:"#".concat(a.GRID_LINES.toString(16).padStart(6,"0"))},camera:{mode:o.PERSPECTIVE,fov:l,near:p,far:f,position:M(h)},transform:{mode:r.TRANSLATE,space:"local",snapUnit:.1},lighting:{ambient:{intensity:u.AMBIENT_INTENSITY,color:"#".concat(u.AMBIENT_COLOR.toString(16).padStart(6,"0"))},directional:{intensity:u.DIRECTIONAL_INTENSITY,color:"#".concat(u.DIRECTIONAL_COLOR.toString(16).padStart(6,"0")),position:M(u.DIRECTIONAL_POSITION)},castShadow:!0},ui:{enabled:!1,panels:{shapes:!0,properties:!0,outliner:!0,controls:!0}},features:{grouping:!0,undo:!0,export:!0},history:{enabled:!0,maxSize:50},callbacks:{onObjectAdded:null,onObjectRemoved:null,onSelectionChanged:null,onTransformChange:null,onGroupCreated:null,onGroupRemoved:null}},D=function(){return e=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=this.mergeConfig(t),this.validate()},t=[{key:"mergeConfig",value:function(e){return g(L,e)}},{key:"validate",value:function(){if(!this.config.container)throw new Error("SWK: Container selector or element is required");return Object.values(o).includes(this.config.camera.mode)||(this.config.camera.mode=o.PERSPECTIVE),Object.values(r).includes(this.config.transform.mode)||(this.config.transform.mode=r.TRANSLATE),this.config.transform.snapUnit<0&&(this.config.transform.snapUnit=0),!0}},{key:"get",value:function(e){var t,n=e.split("."),r=this.config,o=C(n);try{for(o.s();!(t=o.n()).done;){var i=t.value;if(!r||"object"!==T(r)||!(i in r))return;r=r[i]}}catch(e){o.e(e)}finally{o.f()}return r}},{key:"set",value:function(e,t){var n,r=e.split("."),o=r.pop(),i=this.config,a=C(r);try{for(a.s();!(n=a.n()).done;){var s=n.value;s in i||(i[s]={}),i=i[s]}}catch(e){a.e(e)}finally{a.f()}i[o]=t}},{key:"getAll",value:function(){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?E(Object(n),!0).forEach(function(t){j(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):E(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},this.config)}}],t&&P(e.prototype,t),n&&P(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n}();function I(e){return I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},I(e)}function G(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,H(r.key),r)}}function H(e){var t=function(e,t){if("object"!=I(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=I(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==I(t)?t:t+""}var N=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.events={}},t=[{key:"on",value:function(e,t){return this.events[e]||(this.events[e]=[]),this.events[e].push(t),this}},{key:"once",value:function(e,t){var n=this,r=function(){t.apply(void 0,arguments),n.off(e,r)};return this.on(e,r)}},{key:"off",value:function(e,t){return this.events[e]?(t?this.events[e]=this.events[e].filter(function(e){return e!==t}):delete this.events[e],this):this}},{key:"emit",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return this.events[e]?(this.events[e].forEach(function(e){try{e.apply(void 0,n)}catch(e){}}),this):this}},{key:"removeAllListeners",value:function(){return this.events={},this}}],t&&G(e.prototype,t),n&&G(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n}();function _(e){return _="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_(e)}function F(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,B(r.key),r)}}function B(e){var t=function(e,t){if("object"!=_(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=_(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==_(t)?t:t+""}var U=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)},n=[{key:"fromAPI",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof e){if(!(t=document.querySelector(e)))throw new Error("SWK: Container element not found: ".concat(e))}else{if(!(e instanceof HTMLElement))throw new Error("SWK: Invalid container selector or element");t=e}return{container:t,config:n}}},{key:"autoInit",value:function(e){var t=document.querySelectorAll("[data-swk]"),n=[];return t.forEach(function(t){try{var r=O(t),o=new e(t,r);n.push(o)}catch(e){}}),n}},{key:"fromHTML",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!(e instanceof HTMLElement))throw new Error("SWK: Invalid HTML element");return{container:e,config:t}}},{key:"parseConfig",value:function(e){return O(e)}}],(t=null)&&F(e.prototype,t),n&&F(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n}();function z(e){return z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},z(e)}function W(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,K(r.key),r)}}function K(e){var t=function(e,t){if("object"!=z(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=z(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==z(t)?t:t+""}var V=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=t,this.scene=null,this.gridHelper=null,this.init()},(t=[{key:"init",value:function(){this.scene=new THREE.Scene,this.config.get("grid.show")&&this.createGrid()}},{key:"createGrid",value:function(){var e=this.config.get("grid.size"),t=this.config.get("grid.divisions"),n=this.hexToNumber(this.config.get("grid.centerColor")),r=this.hexToNumber(this.config.get("grid.linesColor"));this.gridHelper=new THREE.GridHelper(e,t,n,r),this.scene.add(this.gridHelper)}},{key:"hexToNumber",value:function(e){return parseInt(e.replace("#",""),16)}},{key:"getScene",value:function(){return this.scene}},{key:"add",value:function(e){this.scene.add(e)}},{key:"remove",value:function(e){this.scene.remove(e)}},{key:"showGrid",value:function(){this.gridHelper?this.gridHelper.visible=!0:this.createGrid()}},{key:"hideGrid",value:function(){this.gridHelper&&(this.gridHelper.visible=!1)}},{key:"toggleGrid",value:function(){this.gridHelper&&(this.gridHelper.visible=!this.gridHelper.visible)}},{key:"dispose",value:function(){this.gridHelper&&(this.scene.remove(this.gridHelper),this.gridHelper.geometry.dispose(),this.gridHelper.material.dispose())}}])&&W(e.prototype,t),n&&W(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n}();function q(e){return q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},q(e)}function X(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Y(r.key),r)}}function Y(e){var t=function(e,t){if("object"!=q(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=q(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==q(t)?t:t+""}var Q=function(){return e=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.container=t,this.config=n,this.renderer=null,this.init()},(t=[{key:"init",value:function(){this.renderer=new THREE.WebGLRenderer({antialias:!0,alpha:!0});var e=this.container.clientWidth,t=this.container.clientHeight;this.renderer.setSize(e,t),this.renderer.setPixelRatio(window.devicePixelRatio);var n=this.config.get("viewportBackground");this.renderer.setClearColor(this.hexToNumber(n)),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=THREE.PCFSoftShadowMap,this.container.appendChild(this.renderer.domElement),window.addEventListener("resize",this.onResize.bind(this))}},{key:"onResize",value:function(){var e=this.container.clientWidth,t=this.container.clientHeight;this.renderer.setSize(e,t)}},{key:"hexToNumber",value:function(e){return parseInt(e.replace("#",""),16)}},{key:"render",value:function(e,t){this.renderer.render(e,t)}},{key:"getRenderer",value:function(){return this.renderer}},{key:"setBackgroundColor",value:function(e){this.renderer.setClearColor(this.hexToNumber(e))}},{key:"getCanvas",value:function(){return this.renderer.domElement}},{key:"dispose",value:function(){window.removeEventListener("resize",this.onResize.bind(this)),this.renderer&&(this.renderer.dispose(),this.renderer.domElement.parentNode&&this.renderer.domElement.parentNode.removeChild(this.renderer.domElement))}}])&&X(e.prototype,t),n&&X(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n}();function $(e){return $="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},$(e)}function J(e){return function(e){if(Array.isArray(e))return Z(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return Z(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Z(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Z(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function ee(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,te(r.key),r)}}function te(e){var t=function(e,t){if("object"!=$(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=$(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==$(t)?t:t+""}var ne=function(){return e=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.container=t,this.config=n,this.perspectiveCamera=null,this.orthographicCamera=null,this.currentCamera=null,this.currentMode=n.get("camera.mode"),this.controls=null,this.init()},(t=[{key:"init",value:function(){var e,t,n=this.container.clientWidth/this.container.clientHeight,r=this.config.get("camera.fov"),i=this.config.get("camera.near"),a=this.config.get("camera.far");this.perspectiveCamera=new THREE.PerspectiveCamera(r,n,i,a),this.orthographicCamera=new THREE.OrthographicCamera(10*n/-2,10*n/2,5,-5,i,a);var s=this.config.get("camera.position");(e=this.perspectiveCamera.position).set.apply(e,J(s)),(t=this.orthographicCamera.position).set.apply(t,J(s)),this.currentCamera=this.currentMode===o.PERSPECTIVE?this.perspectiveCamera:this.orthographicCamera,window.addEventListener("resize",this.onResize.bind(this))}},{key:"onResize",value:function(){var e=this.container.clientWidth/this.container.clientHeight;this.perspectiveCamera.aspect=e,this.perspectiveCamera.updateProjectionMatrix(),this.orthographicCamera.left=10*e/-2,this.orthographicCamera.right=10*e/2,this.orthographicCamera.top=5,this.orthographicCamera.bottom=-5,this.orthographicCamera.updateProjectionMatrix()}},{key:"getCamera",value:function(){return this.currentCamera}},{key:"getPerspectiveCamera",value:function(){return this.perspectiveCamera}},{key:"getOrthographicCamera",value:function(){return this.orthographicCamera}},{key:"setMode",value:function(e){if(Object.values(o).includes(e)){var t=this.currentCamera.position.clone(),n=this.controls?this.controls.target.clone():new THREE.Vector3;this.currentMode=e,this.currentCamera=e===o.PERSPECTIVE?this.perspectiveCamera:this.orthographicCamera,this.currentCamera.position.copy(t),this.controls&&(this.controls.object=this.currentCamera,this.controls.target.copy(n),this.controls.update())}}},{key:"getMode",value:function(){return this.currentMode}},{key:"setControls",value:function(e){this.controls=e}},{key:"reset",value:function(){var e,t=this.config.get("camera.position");(e=this.currentCamera.position).set.apply(e,J(t)),this.controls&&(this.controls.target.set(0,0,0),this.controls.update())}},{key:"dispose",value:function(){window.removeEventListener("resize",this.onResize.bind(this))}}])&&ee(e.prototype,t),n&&ee(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n}();function re(e){return re="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},re(e)}function oe(e){return function(e){if(Array.isArray(e))return ie(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return ie(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ie(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ie(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function ae(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,se(r.key),r)}}function se(e){var t=function(e,t){if("object"!=re(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=re(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==re(t)?t:t+""}var ce=function(){return e=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.scene=t,this.config=n,this.ambientLight=null,this.directionalLight=null,this.init()},(t=[{key:"init",value:function(){var e,t=this.config.get("lighting.ambient.intensity"),n=this.hexToNumber(this.config.get("lighting.ambient.color"));this.ambientLight=new THREE.AmbientLight(n,t),this.scene.add(this.ambientLight);var r=this.config.get("lighting.directional.intensity"),o=this.hexToNumber(this.config.get("lighting.directional.color")),i=this.config.get("lighting.directional.position");this.directionalLight=new THREE.DirectionalLight(o,r),(e=this.directionalLight.position).set.apply(e,oe(i)),this.config.get("lighting.castShadow")&&(this.directionalLight.castShadow=!0,this.directionalLight.shadow.mapSize.width=2048,this.directionalLight.shadow.mapSize.height=2048,this.directionalLight.shadow.camera.near=.5,this.directionalLight.shadow.camera.far=50,this.directionalLight.shadow.camera.left=-10,this.directionalLight.shadow.camera.right=10,this.directionalLight.shadow.camera.top=10,this.directionalLight.shadow.camera.bottom=-10),this.scene.add(this.directionalLight)}},{key:"hexToNumber",value:function(e){return parseInt(e.replace("#",""),16)}},{key:"setAmbientIntensity",value:function(e){this.ambientLight&&(this.ambientLight.intensity=e)}},{key:"setDirectionalIntensity",value:function(e){this.directionalLight&&(this.directionalLight.intensity=e)}},{key:"setAmbientColor",value:function(e){this.ambientLight&&this.ambientLight.color.set(this.hexToNumber(e))}},{key:"setDirectionalColor",value:function(e){this.directionalLight&&this.directionalLight.color.set(this.hexToNumber(e))}},{key:"getAmbientLight",value:function(){return this.ambientLight}},{key:"getDirectionalLight",value:function(){return this.directionalLight}},{key:"dispose",value:function(){this.ambientLight&&this.scene.remove(this.ambientLight),this.directionalLight&&this.scene.remove(this.directionalLight)}}])&&ae(e.prototype,t),n&&ae(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n}();function ue(e){return ue="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ue(e)}function le(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function pe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?le(Object(n),!0).forEach(function(t){fe(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):le(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function fe(e,t,n){return(t=ve(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function he(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,s=[],c=!0,u=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(s.push(r.value),s.length!==t);c=!0);}catch(e){u=!0,o=e}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw o}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return ye(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ye(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ye(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function de(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,ve(r.key),r)}}function ve(e){var t=function(e,t){if("object"!=ue(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=ue(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==ue(t)?t:t+""}var me=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=t,this.fontLoader=new THREE.FontLoader,this.fonts={},this.shapeCounters={box:0,sphere:0,cylinder:0,cone:0,torus:0,plane:0,pyramid:0,torusknot:0,tetrahedron:0,octahedron:0,icosahedron:0,dodecahedron:0,text:0}},t=[{key:"loadFonts",value:function(e){for(var t=this,n={sans:"https://threejs.org/examples/fonts/helvetiker_regular.typeface.json",mono:"/src/font/DM_Mono_Regular.json",serif:"https://threejs.org/examples/fonts/gentilis_regular.typeface.json"},r=0,o=Object.keys(n).length,i=function(){var n=he(s[a],2),i=n[0],c=n[1];t.fontLoader.load(c,function(n){t.fonts[i]=n,++r===o&&e&&e()},void 0,function(t){++r===o&&e&&e()})},a=0,s=Object.entries(n);a<s.length;a++)i()}},{key:"createShape",value:function(e){var t,r,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=e.toLowerCase();if(!Object.values(n).includes(i))return null;var s=!1;switch(i){case n.BOX:t=new THREE.BoxGeometry(1,1,1),this.shapeCounters.box++,r="Box ".concat(this.shapeCounters.box);break;case n.SPHERE:t=new THREE.SphereGeometry(.5,32,32),this.shapeCounters.sphere++,r="Sphere ".concat(this.shapeCounters.sphere);break;case n.CYLINDER:t=new THREE.CylinderGeometry(.5,.5,1,32),this.shapeCounters.cylinder++,r="Cylinder ".concat(this.shapeCounters.cylinder);break;case n.CONE:t=new THREE.ConeGeometry(.5,1,32),this.shapeCounters.cone++,r="Cone ".concat(this.shapeCounters.cone);break;case n.TORUS:t=new THREE.TorusGeometry(.5,.2,16,100),this.shapeCounters.torus++,r="Torus ".concat(this.shapeCounters.torus);break;case n.PLANE:t=new THREE.PlaneGeometry(1,1),this.shapeCounters.plane++,r="Plane ".concat(this.shapeCounters.plane),s=!0;break;case n.PYRAMID:t=new THREE.ConeGeometry(.7,1,4),this.shapeCounters.pyramid++,r="Pyramid ".concat(this.shapeCounters.pyramid);break;case n.TORUS_KNOT:t=new THREE.TorusKnotGeometry(.4,.15,100,16),this.shapeCounters.torusknot++,r="TorusKnot ".concat(this.shapeCounters.torusknot);break;case n.TETRAHEDRON:t=new THREE.TetrahedronGeometry(.7),this.shapeCounters.tetrahedron++,r="Tetrahedron ".concat(this.shapeCounters.tetrahedron);break;case n.OCTAHEDRON:t=new THREE.OctahedronGeometry(.7),this.shapeCounters.octahedron++,r="Octahedron ".concat(this.shapeCounters.octahedron);break;case n.ICOSAHEDRON:t=new THREE.IcosahedronGeometry(.7),this.shapeCounters.icosahedron++,r="Icosahedron ".concat(this.shapeCounters.icosahedron);break;case n.DODECAHEDRON:t=new THREE.DodecahedronGeometry(.7),this.shapeCounters.dodecahedron++,r="Dodecahedron ".concat(this.shapeCounters.dodecahedron);break;case n.TEXT:var c=o.text||"Text",u=o.font||"sans",l=o.height||.2,p=o.bevel||.01;if(!(t=this.createTextGeometry(c,u,l,p)))return null;this.shapeCounters.text++,r="Text ".concat(this.shapeCounters.text),s=!0}t.computeBoundingBox(),t.computeBoundingSphere(),t.center();var f=o.color||a.SHAPE_DEFAULT,h=new THREE.MeshStandardMaterial({color:f,roughness:.5,metalness:.3,transparent:!1,opacity:1}),y=new THREE.Mesh(t,h);if(y.name=r,y.castShadow=!0,y.receiveShadow=!0,y.userData.color=f,y.userData.shapeType=i,s||i===n.TEXT)y.position.set(0,0,0);else{var d=t.boundingBox,v=d.max.y-d.min.y;y.position.set(0,v/2,0)}return i===n.TEXT&&(y.userData.textContent=o.text||"Text",y.userData.textFont=o.font||"sans",y.userData.textHeight=o.height||.2,y.userData.textBevel=o.bevel||.01),y}},{key:"createTextGeometry",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"sans",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.2,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.01;if(!this.fonts[t]&&(t="sans",!this.fonts[t]))return null;var o=new THREE.TextGeometry(e,{font:this.fonts[t],size:1,height:n,curveSegments:12,bevelEnabled:!0,bevelThickness:r,bevelSize:r,bevelSegments:5});return o.computeBoundingBox(),o.computeBoundingSphere(),o.center(),o}},{key:"updateTextGeometry",value:function(e,t,r,o,i){if(e.userData.shapeType!==n.TEXT)return!1;var a=this.createTextGeometry(t,r,o,i);return!!a&&(e.geometry.dispose(),e.geometry=a,e.userData.textContent=t,e.userData.textFont=r,e.userData.textHeight=o,e.userData.textBevel=i,!0)}},{key:"getCounters",value:function(){return pe({},this.shapeCounters)}},{key:"setCounters",value:function(e){this.shapeCounters=pe({},e)}}],t&&de(e.prototype,t),r&&de(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r}();function be(e){return be="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},be(e)}function ge(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,we(r.key),r)}}function we(e){var t=function(e,t){if("object"!=be(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=be(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==be(t)?t:t+""}var ke=function(){return e=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.camera=t,this.renderer=n,this.raycaster=new THREE.Raycaster,this.mouse=new THREE.Vector2},t=[{key:"updateMousePosition",value:function(e,t){var n=t.getBoundingClientRect();this.mouse.x=(e.clientX-n.left)/n.width*2-1,this.mouse.y=-(e.clientY-n.top)/n.height*2+1}},{key:"pick",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e||0===e.length)return null;this.raycaster.setFromCamera(this.mouse,this.camera);var n=this.raycaster.intersectObjects(e,t);return n.length>0?n[0]:null}},{key:"pickAll",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e&&0!==e.length?(this.raycaster.setFromCamera(this.mouse,this.camera),this.raycaster.intersectObjects(e,t)):[]}},{key:"pickFromEvent",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return this.updateMousePosition(e,t),this.pick(n,r)}},{key:"getMousePosition",value:function(){return this.mouse.clone()}},{key:"setCamera",value:function(e){this.camera=e}}],t&&ge(e.prototype,t),n&&ge(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n}();function Se(e){return Se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Se(e)}function Oe(e){return function(e){if(Array.isArray(e))return Ee(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return Ee(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ee(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ee(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function je(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Te(r.key),r)}}function Te(e){var t=function(e,t){if("object"!=Se(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=Se(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Se(t)?t:t+""}var Ce=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.eventEmitter=t,this.selectedObjects=[],this.selectedObject=null},(t=[{key:"select",value:function(e){if(e){var t=Oe(this.selectedObjects);return this.selectedObjects=[e],this.selectedObject=e,this.eventEmitter.emit("selectionChanged",this.selectedObjects,t),this.selectedObjects}}},{key:"addToSelection",value:function(e){if(e){if(this.selectedObjects.includes(e))return this.selectedObjects;var t=Oe(this.selectedObjects);return this.selectedObjects.push(e),this.selectedObject=this.selectedObjects[0],this.eventEmitter.emit("selectionChanged",this.selectedObjects,t),this.selectedObjects}}},{key:"removeFromSelection",value:function(e){if(e){var t=this.selectedObjects.indexOf(e);if(-1!==t){var n=Oe(this.selectedObjects);return this.selectedObjects.splice(t,1),this.selectedObject=this.selectedObjects.length>0?this.selectedObjects[0]:null,this.eventEmitter.emit("selectionChanged",this.selectedObjects,n),this.selectedObjects}}}},{key:"toggle",value:function(e){if(e)return this.selectedObjects.includes(e)?this.removeFromSelection(e):this.addToSelection(e),this.selectedObjects}},{key:"clear",value:function(){if(0!==this.selectedObjects.length){var e=Oe(this.selectedObjects);this.selectedObjects=[],this.selectedObject=null,this.eventEmitter.emit("selectionChanged",[],e)}}},{key:"isSelected",value:function(e){return this.selectedObjects.includes(e)}},{key:"getSelectedObjects",value:function(){return Oe(this.selectedObjects)}},{key:"getSelectedObject",value:function(){return this.selectedObject}},{key:"getSelectionCount",value:function(){return this.selectedObjects.length}},{key:"hasSelection",value:function(){return this.selectedObjects.length>0}},{key:"hasMultipleSelections",value:function(){return this.selectedObjects.length>1}}])&&je(e.prototype,t),n&&je(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n}();function Pe(e){return Pe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Pe(e)}function xe(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,s=[],c=!0,u=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(s.push(r.value),s.length!==t);c=!0);}catch(e){u=!0,o=e}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw o}}return s}}(e,t)||Re(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Me(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=Re(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function Re(e,t){if(e){if("string"==typeof e)return Ae(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ae(e,t):void 0}}function Ae(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function Le(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,De(r.key),r)}}function De(e){var t=function(e,t){if("object"!=Pe(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=Pe(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Pe(t)?t:t+""}var Ie=function(){return e=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.scene=t,this.config=n,this.outlineMap=new Map,this.outlineColor=this.hexToNumber(n.get("outlineColor")),this.outlineThickness=n.get("outlineThickness")||.04},(t=[{key:"createOutline",value:function(e){if(!e||!e.geometry)return null;this.removeOutline(e);var t=e.geometry.clone(),n=new THREE.MeshBasicMaterial({color:this.outlineColor,side:THREE.BackSide,depthWrite:!1,polygonOffset:!0,polygonOffsetFactor:1,polygonOffsetUnits:1}),r=new THREE.Mesh(t,n),o=void 0!==e.userData.textContent;return this.updateOutlineTransform(e,r,o),this.scene.add(r),this.outlineMap.set(e,{outline:r,mesh:e,isText:o}),r}},{key:"updateOutlineTransform",value:function(e,t,n){var r=new THREE.Vector3,o=new THREE.Quaternion,i=new THREE.Vector3;if(e.getWorldPosition(r),e.getWorldQuaternion(o),e.getWorldScale(i),n){var a=this.outlineThickness;t.position.copy(r),t.position.x+=a,t.position.y+=a,t.quaternion.copy(o),t.scale.copy(i)}else t.position.copy(r),t.quaternion.copy(o),t.scale.copy(i).multiplyScalar(1+this.outlineThickness)}},{key:"removeOutline",value:function(e){var t=this.outlineMap.get(e);t&&(this.scene.remove(t.outline),t.outline.geometry&&t.outline.geometry.dispose(),t.outline.material&&t.outline.material.dispose(),this.outlineMap.delete(e))}},{key:"syncOutlines",value:function(){var e,t=Me(this.outlineMap.entries());try{for(t.s();!(e=t.n()).done;){var n=xe(e.value,2),r=n[0],o=n[1];o&&o.outline&&this.updateOutlineTransform(r,o.outline,o.isText)}}catch(e){t.e(e)}finally{t.f()}}},{key:"createOutlines",value:function(e){var t=this;e&&Array.isArray(e)&&e.forEach(function(e){return t.createOutline(e)})}},{key:"removeOutlines",value:function(e){var t=this;e&&Array.isArray(e)&&e.forEach(function(e){return t.removeOutline(e)})}},{key:"clearAllOutlines",value:function(){var e,t=Me(this.outlineMap.entries());try{for(t.s();!(e=t.n()).done;){var n=xe(e.value,2),r=(n[0],n[1]);this.scene.remove(r.outline),r.outline.geometry&&r.outline.geometry.dispose(),r.outline.material&&r.outline.material.dispose()}}catch(e){t.e(e)}finally{t.f()}this.outlineMap.clear()}},{key:"setOutlineColor",value:function(e){this.outlineColor=this.hexToNumber(e);var t,n=Me(this.outlineMap.entries());try{for(n.s();!(t=n.n()).done;){var r=xe(t.value,2),o=(r[0],r[1]);o.outline.material&&o.outline.material.color.set(this.outlineColor)}}catch(e){n.e(e)}finally{n.f()}}},{key:"hexToNumber",value:function(e){return parseInt(e.replace("#",""),16)}},{key:"getOutline",value:function(e){var t=this.outlineMap.get(e);return t?t.outline:null}},{key:"hasOutline",value:function(e){return this.outlineMap.has(e)}},{key:"dispose",value:function(){this.clearAllOutlines()}}])&&Le(e.prototype,t),n&&Le(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n}();function Ge(e){return Ge="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ge(e)}function He(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Ne(r.key),r)}}function Ne(e){var t=function(e,t){if("object"!=Ge(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=Ge(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Ge(t)?t:t+""}var _e=function(){return e=function e(t,n,r,o,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.camera=t,this.canvas=n,this.scene=r,this.config=o,this.eventEmitter=i,this.transformControls=null,this.currentMode=o.get("transform.mode"),this.currentSpace=o.get("transform.space"),this.init()},(t=[{key:"init",value:function(){this.transformControls=new THREE.TransformControls(this.camera,this.canvas),this.transformControls.setMode(this.currentMode),this.transformControls.setSpace(this.currentSpace),this.scene.add(this.transformControls),this.transformControls.addEventListener("change",this.onChange.bind(this)),this.transformControls.addEventListener("dragging-changed",this.onDraggingChanged.bind(this)),this.transformControls.addEventListener("objectChange",this.onObjectChange.bind(this))}},{key:"onChange",value:function(){this.eventEmitter.emit("transform")}},{key:"onDraggingChanged",value:function(e){this.eventEmitter.emit("transformDragging",e.value),this.eventEmitter.emit("orbitControlsEnabled",!e.value)}},{key:"onObjectChange",value:function(){var e=this.transformControls.object;if(e){this.eventEmitter.emit("objectTransformed",e);var t=this.config.get("callbacks.onTransformChange");t&&"function"==typeof t&&t(e)}}},{key:"setMode",value:function(e){Object.values(r).includes(e)&&(this.currentMode=e,this.transformControls.setMode(e),this.config.set("transform.mode",e),this.eventEmitter.emit("transformModeChanged",e))}},{key:"getMode",value:function(){return this.currentMode}},{key:"setSpace",value:function(e){"local"!==e&&"world"!==e||(this.currentSpace=e,this.transformControls.setSpace(e),this.config.set("transform.space",e),this.eventEmitter.emit("transformSpaceChanged",e))}},{key:"getSpace",value:function(){return this.currentSpace}},{key:"attach",value:function(e){e&&this.transformControls.attach(e)}},{key:"detach",value:function(){this.transformControls.detach()}},{key:"getAttachedObject",value:function(){return this.transformControls.object||null}},{key:"isDragging",value:function(){return this.transformControls.dragging||!1}},{key:"enable",value:function(){this.transformControls.enabled=!0}},{key:"disable",value:function(){this.transformControls.enabled=!1}},{key:"setCamera",value:function(e){this.camera=e,this.transformControls.camera=e}},{key:"getControls",value:function(){return this.transformControls}},{key:"dispose",value:function(){this.transformControls&&(this.transformControls.removeEventListener("change",this.onChange.bind(this)),this.transformControls.removeEventListener("dragging-changed",this.onDraggingChanged.bind(this)),this.transformControls.removeEventListener("objectChange",this.onObjectChange.bind(this)),this.transformControls.detach(),this.scene.remove(this.transformControls),this.transformControls.dispose())}}])&&He(e.prototype,t),n&&He(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n}();function Fe(e){return Fe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Fe(e)}function Be(e){return function(e){if(Array.isArray(e))return Ue(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return Ue(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ue(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ue(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function ze(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,We(r.key),r)}}function We(e){var t=function(e,t){if("object"!=Fe(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=Fe(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Fe(t)?t:t+""}var Ke=function(){return e=function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.transformControls=t,this.config=n,this.eventEmitter=r,this.snapUnit=n.get("transform.snapUnit"),this.rotationSnapDegrees=15,this.applySnap()},(t=[{key:"applySnap",value:function(){if(this.transformControls){this.transformControls.setTranslationSnap(this.snapUnit);var e=this.snapUnit>0?this.rotationSnapDegrees*(Math.PI/180):null;this.transformControls.setRotationSnap(e),this.transformControls.setScaleSnap(this.snapUnit)}}},{key:"setSnapUnit",value:function(e){"number"!=typeof e||e<0||(this.snapUnit=e,this.config.set("transform.snapUnit",e),this.applySnap(),this.eventEmitter.emit("snapUnitChanged",e))}},{key:"getSnapUnit",value:function(){return this.snapUnit}},{key:"setRotationSnap",value:function(e){"number"!=typeof e||e<0||(this.rotationSnapDegrees=e,this.applySnap(),this.eventEmitter.emit("rotationSnapChanged",e))}},{key:"getRotationSnap",value:function(){return this.rotationSnapDegrees}},{key:"toggleSnap",value:function(){this.snapUnit>0?this.setSnapUnit(0):this.setSnapUnit(.1)}},{key:"isSnapEnabled",value:function(){return this.snapUnit>0}},{key:"cycleSnapValue",value:function(){var e=(i.indexOf(this.snapUnit)+1)%i.length;this.setSnapUnit(i[e])}},{key:"getAvailableSnapValues",value:function(){return Be(i)}}])&&ze(e.prototype,t),n&&ze(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n}();function Ve(e){return Ve="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ve(e)}function qe(e){return function(e){if(Array.isArray(e))return Xe(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return Xe(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Xe(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Xe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function Ye(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Qe(r.key),r)}}function Qe(e){var t=function(e,t){if("object"!=Ve(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=Ve(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Ve(t)?t:t+""}var $e=function(){return e=function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.scene=t,this.eventEmitter=n,this.config=r,this.groups=[],this.groupIdCounter=0},t=[{key:"createGroup",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!e||0===e.length)return null;var n="group_".concat(this.groupIdCounter++),r=t||"Group ".concat(this.groups.length+1),o={id:n,name:r,children:qe(e),container:null,isDirty:!0};e.forEach(function(e){e.userData.groupId=n}),this.groups.push(o),this.computeGroupContainer(o),this.eventEmitter.emit("groupCreated",o.container);var i=this.config.get("callbacks.onGroupCreated");return i&&"function"==typeof i&&i(o.container),o.container}},{key:"computeGroupContainer",value:function(e){if(e.container&&this.scene.remove(e.container),0!==e.children.length){var t=new THREE.Box3;e.children.forEach(function(e){t.expandByObject(e)});var n=t.getCenter(new THREE.Vector3),r=new THREE.Group;r.userData.isGroupResult=!0,r.userData.groupId=e.id,r.name=e.name,r.position.copy(n),e.children.forEach(function(e){var t=new THREE.Vector3,o=new THREE.Quaternion,i=new THREE.Vector3;e.getWorldPosition(t),e.getWorldQuaternion(o),e.getWorldScale(i),e.parent&&e.parent.remove(e),r.add(e),e.position.copy(t).sub(n),e.quaternion.copy(o),e.scale.copy(i)}),this.scene.add(r),e.container=r,e.isDirty=!1}}},{key:"ungroup",value:function(e){var t=this;if(!e||!e.userData.isGroupResult)return null;var n=e.userData.groupId,r=this.groups.findIndex(function(e){return e.id===n});if(-1===r)return null;var o=this.groups[r],i=[];qe(o.children).forEach(function(e){var n=new THREE.Vector3,r=new THREE.Quaternion,a=new THREE.Vector3;e.getWorldPosition(n),e.getWorldQuaternion(r),e.getWorldScale(a),o.container.remove(e),t.scene.add(e),e.position.copy(n),e.quaternion.copy(r),e.scale.copy(a),e.userData.groupId=null,i.push(e)}),this.scene.remove(o.container),this.groups.splice(r,1),this.eventEmitter.emit("groupRemoved",o.container);var a=this.config.get("callbacks.onGroupRemoved");return a&&"function"==typeof a&&a(o.container),i}},{key:"getGroupById",value:function(e){return this.groups.find(function(t){return t.id===e})}},{key:"getGroupByContainer",value:function(e){return e&&e.userData.groupId?this.getGroupById(e.userData.groupId):null}},{key:"isGrouped",value:function(e){return e&&e.userData&&void 0!==e.userData.groupId&&null!==e.userData.groupId}},{key:"isGroupContainer",value:function(e){return e&&e.userData&&!0===e.userData.isGroupResult}},{key:"getAllGroups",value:function(){return qe(this.groups)}},{key:"getGroupChildren",value:function(e){var t=this.getGroupByContainer(e);return t?qe(t.children):[]}},{key:"findObjectGroup",value:function(e){return this.isGrouped(e)?this.getGroupById(e.userData.groupId):null}},{key:"renameGroup",value:function(e,t){var n=this.getGroupByContainer(e);return!!n&&(n.name=t,n.container.name=t,!0)}},{key:"removeFromGroup",value:function(e){var t=this.findObjectGroup(e);if(!t)return!1;var n=new THREE.Vector3,r=new THREE.Quaternion,o=new THREE.Vector3;e.getWorldPosition(n),e.getWorldQuaternion(r),e.getWorldScale(o);var i=t.children.indexOf(e);if(i>-1&&t.children.splice(i,1),t.container.remove(e),this.scene.add(e),e.position.copy(n),e.quaternion.copy(r),e.scale.copy(o),e.userData.groupId=null,0===t.children.length){this.scene.remove(t.container);var a=this.groups.indexOf(t);a>-1&&this.groups.splice(a,1)}return!0}},{key:"addToGroup",value:function(e,t){var n=this.getGroupByContainer(t);if(!n)return!1;this.isGrouped(e)&&this.removeFromGroup(e);var r=new THREE.Vector3,o=new THREE.Quaternion,i=new THREE.Vector3;e.getWorldPosition(r),e.getWorldQuaternion(o),e.getWorldScale(i),e.parent&&e.parent.remove(e),n.container.add(e),n.children.push(e);var a=n.container.position;return e.position.copy(r).sub(a),e.quaternion.copy(o),e.scale.copy(i),e.userData.groupId=n.id,!0}},{key:"clearAllGroups",value:function(){var e=this;qe(this.groups).forEach(function(t){t.container&&e.ungroup(t.container)})}},{key:"getStats",value:function(){return{totalGroups:this.groups.length,groups:this.groups.map(function(e){return{id:e.id,name:e.name,childCount:e.children.length}})}}}],t&&Ye(e.prototype,t),n&&Ye(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n}();function Je(e){return Je="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Je(e)}function Ze(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function et(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ze(Object(n),!0).forEach(function(t){tt(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ze(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function tt(e,t,n){return(t=rt(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function nt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,rt(r.key),r)}}function rt(e){var t=function(e,t){if("object"!=Je(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=Je(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Je(t)?t:t+""}const ot=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)},r=[{key:"captureState",value:function(e,t,n,r){var o=this,i={timestamp:Date.now(),objects:[],groups:[],selection:[],counters:{}};r&&r.shapeCounters&&(i.counters=et({},r.shapeCounters)),e.children.filter(function(e){return e.userData&&e.userData.isUserObject}).forEach(function(e){n&&n.isGroupContainer(e)?i.groups.push(o.serializeGroup(e,n)):n&&n.isGrouped(e)||i.objects.push(o.serializeObject(e))});var a=t.getSelectedObjects();return i.selection=a.map(function(e){return e.uuid}),i}},{key:"serializeObject",value:function(e){var t={uuid:e.uuid,name:e.name,type:e.userData.shapeType||"unknown",position:e.position.toArray(),rotation:e.rotation.toArray(),scale:e.scale.toArray(),visible:e.visible,userData:et({},e.userData)};return e.material&&(t.material={color:e.material.color.getHex(),opacity:e.material.opacity,transparent:e.material.transparent,wireframe:e.material.wireframe}),t.type===n.TEXT&&e.userData.textContent&&(t.textContent=e.userData.textContent,t.textFont=e.userData.textFont||"sans"),t}},{key:"serializeGroup",value:function(e,t){var n=this,r={uuid:e.uuid,name:e.name,position:e.position.toArray(),rotation:e.rotation.toArray(),scale:e.scale.toArray(),visible:e.visible,children:[]};return t.getGroupChildren(e).forEach(function(e){r.children.push(n.serializeObject(e))}),r}},{key:"restoreState",value:function(e,t,n,r,o){var i=this,a=[],s=new Map;return t.children.filter(function(e){return e.userData&&e.userData.isUserObject}).forEach(function(e){t.remove(e),e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()}),n.clear(),e.counters&&o&&(o.shapeCounters=et({},e.counters)),e.objects.forEach(function(e){var n=i.deserializeObject(e,o);n&&(t.add(n),a.push(n),s.set(e.uuid,n))}),e.groups.forEach(function(e){var n=i.deserializeGroup(e,o),c=n.group,u=n.children;if(c&&u.length>0){u.forEach(function(e){t.add(e),a.push(e)});var l=r.createGroup(u);l&&(l.position.fromArray(e.position),l.rotation.fromArray(e.rotation),l.scale.fromArray(e.scale),l.visible=e.visible,l.name=e.name,a.push(l),s.set(e.uuid,l))}}),e.selection&&e.selection.length>0&&e.selection.forEach(function(e){var t=s.get(e);t&&n.addToSelection(t)}),a}},{key:"deserializeObject",value:function(e,t){var r;if(!t)return null;var o={color:null===(r=e.material)||void 0===r?void 0:r.color,position:e.position,rotation:e.rotation.slice(0,3),scale:e.scale};e.type===n.TEXT&&(o.text=e.textContent||"Text",o.font=e.textFont||"sans");var i=t.createShape(e.type,o);return i?(i.uuid=e.uuid,i.name=e.name,i.visible=e.visible,i.userData=et({},e.userData),e.material&&i.material&&(i.material.opacity=e.material.opacity,i.material.transparent=e.material.transparent,i.material.wireframe=e.material.wireframe),i):null}},{key:"deserializeGroup",value:function(e,t){var n=this,r=[];return e.children.forEach(function(e){var o=n.deserializeObject(e,t);o&&r.push(o)}),{group:e,children:r}}},{key:"cloneState",value:function(e){return JSON.parse(JSON.stringify(e))}},{key:"areStatesEqual",value:function(e,t){return JSON.stringify(e)===JSON.stringify(t)}}],(t=null)&&nt(e.prototype,t),r&&nt(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r}();function it(e){return it="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},it(e)}function at(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,st(r.key),r)}}function st(e){var t=function(e,t){if("object"!=it(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=it(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==it(t)?t:t+""}function ct(e,t,n){return t=lt(t),function(e,t){if(t&&("object"==it(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,ut()?Reflect.construct(t,n||[],lt(e).constructor):t.apply(e,n))}function ut(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(ut=function(){return!!e})()}function lt(e){return lt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},lt(e)}function pt(e,t){return pt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},pt(e,t)}const ft=function(e){function t(e,n,r,o,i){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(a=ct(this,t)).scene=e,a.selectionManager=n,a.groupManager=r,a.shapeFactory=o,a.config=i,a.undoStack=[],a.redoStack=[],a.maxHistory=i.get("maxHistory")||50,a.isRestoring=!1,a.captureState("Initial state"),a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&pt(e,t)}(t,e),n=t,r=[{key:"captureState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"State change";if(this.isRestoring)return!1;try{var t=ot.captureState(this.scene,this.selectionManager,this.groupManager,this.shapeFactory);if(this.undoStack.length>0){var n=this.undoStack[this.undoStack.length-1];if(ot.areStatesEqual(t,n.state))return!1}return this.undoStack.push({state:t,description:e,timestamp:Date.now()}),this.undoStack.length>this.maxHistory&&this.undoStack.shift(),this.redoStack=[],this.emit("stateChanged",{canUndo:this.canUndo(),canRedo:this.canRedo(),undoCount:this.undoStack.length,redoCount:this.redoStack.length}),!0}catch(e){return!1}}},{key:"undo",value:function(){if(!this.canUndo())return!1;try{var e=ot.captureState(this.scene,this.selectionManager,this.groupManager,this.shapeFactory);this.redoStack.push({state:e,description:"Current state",timestamp:Date.now()}),this.isRestoring=!0,this.undoStack.pop();var t=this.undoStack[this.undoStack.length-1];return ot.restoreState(t.state,this.scene,this.selectionManager,this.groupManager,this.shapeFactory),this.isRestoring=!1,this.emit("stateRestored",{action:"undo",description:t.description}),this.emit("stateChanged",{canUndo:this.canUndo(),canRedo:this.canRedo(),undoCount:this.undoStack.length,redoCount:this.redoStack.length}),!0}catch(e){return this.isRestoring=!1,!1}}},{key:"redo",value:function(){if(!this.canRedo())return!1;try{var e=this.redoStack.pop(),t=ot.captureState(this.scene,this.selectionManager,this.groupManager,this.shapeFactory);return this.undoStack.push({state:t,description:"Redo action",timestamp:Date.now()}),this.isRestoring=!0,ot.restoreState(e.state,this.scene,this.selectionManager,this.groupManager,this.shapeFactory),this.isRestoring=!1,this.emit("stateRestored",{action:"redo",description:e.description}),this.emit("stateChanged",{canUndo:this.canUndo(),canRedo:this.canRedo(),undoCount:this.undoStack.length,redoCount:this.redoStack.length}),!0}catch(e){return this.isRestoring=!1,!1}}},{key:"canUndo",value:function(){return this.undoStack.length>1}},{key:"canRedo",value:function(){return this.redoStack.length>0}},{key:"getUndoDescription",value:function(){var e;return this.canUndo()&&(null===(e=this.undoStack[this.undoStack.length-2])||void 0===e?void 0:e.description)||null}},{key:"getRedoDescription",value:function(){var e;return this.canRedo()&&(null===(e=this.redoStack[this.redoStack.length-1])||void 0===e?void 0:e.description)||null}},{key:"clear",value:function(){this.undoStack=[],this.redoStack=[],this.captureState("History cleared"),this.emit("stateChanged",{canUndo:!1,canRedo:!1,undoCount:this.undoStack.length,redoCount:this.redoStack.length})}},{key:"getStats",value:function(){return{undoCount:this.undoStack.length,redoCount:this.redoStack.length,maxHistory:this.maxHistory,canUndo:this.canUndo(),canRedo:this.canRedo(),memoryUsage:this.estimateMemoryUsage()}}},{key:"estimateMemoryUsage",value:function(){return JSON.stringify(this.undoStack).length+JSON.stringify(this.redoStack).length}},{key:"dispose",value:function(){this.clear(),this.removeAllListeners(),this.scene=null,this.selectionManager=null,this.groupManager=null,this.shapeFactory=null}}],r&&at(n.prototype,r),o&&at(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(N);function ht(e){return ht="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ht(e)}function yt(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var c=r&&r.prototype instanceof s?r:s,u=Object.create(c.prototype);return dt(u,"_invoke",function(n,r,o){var i,s,c,u=0,l=o||[],p=!1,f={p:0,n:0,v:e,a:h,f:h.bind(e,4),d:function(t,n){return i=t,s=0,c=e,f.n=n,a}};function h(n,r){for(s=n,c=r,t=0;!p&&u&&!o&&t<l.length;t++){var o,i=l[t],h=f.p,y=i[2];n>3?(o=y===r)&&(c=i[(s=i[4])?5:(s=3,3)],i[4]=i[5]=e):i[0]<=h&&((o=n<2&&h<i[1])?(s=0,f.v=r,f.n=i[1]):h<y&&(o=n<3||i[0]>r||r>y)&&(i[4]=n,i[5]=r,f.n=y,s=0))}if(o||n>1)return a;throw p=!0,r}return function(o,l,y){if(u>1)throw TypeError("Generator is already running");for(p&&1===l&&h(l,y),s=l,c=y;(t=s<2?e:c)||!p;){i||(s?s<3?(s>1&&(f.n=-1),h(s,c)):f.n=c:f.v=c);try{if(u=2,i){if(s||(o="next"),t=i[o]){if(!(t=t.call(i,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,s<2&&(s=0)}else 1===s&&(t=i.return)&&t.call(i),s<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),s=1);i=e}else if((t=(p=f.n<0)?c:n.call(r,f))!==a)break}catch(t){i=e,s=1,c=t}finally{u=1}}return{value:t,done:p}}}(n,o,i),!0),u}var a={};function s(){}function c(){}function u(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(dt(t={},r,function(){return this}),t),p=u.prototype=s.prototype=Object.create(l);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,dt(e,o,"GeneratorFunction")),e.prototype=Object.create(p),e}return c.prototype=u,dt(p,"constructor",u),dt(u,"constructor",c),c.displayName="GeneratorFunction",dt(u,o,"GeneratorFunction"),dt(p),dt(p,o,"Generator"),dt(p,r,function(){return this}),dt(p,"toString",function(){return"[object Generator]"}),(yt=function(){return{w:i,m:f}})()}function dt(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}dt=function(e,t,n,r){function i(t,n){dt(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(i("next",0),i("throw",1),i("return",2))},dt(e,t,n,r)}function vt(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function mt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,bt(r.key),r)}}function bt(e){var t=function(e,t){if("object"!=ht(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=ht(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==ht(t)?t:t+""}function gt(e,t,n){return t=kt(t),function(e,t){if(t&&("object"==ht(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,wt()?Reflect.construct(t,n||[],kt(e).constructor):t.apply(e,n))}function wt(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(wt=function(){return!!e})()}function kt(e){return kt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},kt(e)}function St(e,t){return St=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},St(e,t)}const Ot=function(e){function t(e,n,r){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=gt(this,t)).container=e,o.swk=n,o.config=r,o.selectedObjects=[],o.isUpdating=!1,o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&St(e,t)}(t,e),r=t,o=[{key:"render",value:function(){this.container.innerHTML='\n            <div class="swk-panel-header">\n                <h3>Properties</h3>\n            </div>\n            <div class="swk-panel-content" id="swk-property-content">\n                <div class="swk-property-empty">\n                    <p>No object selected</p>\n                    <small>Select an object to edit its properties</small>\n                </div>\n            </div>\n        ',this.contentElement=document.getElementById("swk-property-content")}},{key:"updateSelection",value:function(e){this.selectedObjects=e,this.refresh()}},{key:"refresh",value:function(){this.contentElement&&(0===this.selectedObjects.length?this.showEmptyState():1===this.selectedObjects.length?this.showSingleObjectProperties(this.selectedObjects[0]):this.showMultipleObjectsProperties(this.selectedObjects))}},{key:"showEmptyState",value:function(){this.contentElement.innerHTML='\n            <div class="swk-property-empty">\n                <p>No object selected</p>\n                <small>Select an object to edit its properties</small>\n            </div>\n        '}},{key:"showSingleObjectProperties",value:function(e){var t=e.userData.shapeType===n.TEXT,r=this.swk.isGroupContainer(e);this.contentElement.innerHTML='\n            <div class="swk-property-section">\n                <div class="swk-property-group">\n                    <label class="swk-property-label">Name</label>\n                    <input type="text" class="swk-property-input" id="prop-name" value="'.concat(e.name,'">\n                </div>\n                \n                <div class="swk-property-group">\n                    <label class="swk-property-label">Type</label>\n                    <input type="text" class="swk-property-input" readonly value="').concat(r?"Group":e.userData.shapeType||"Object",'">\n                </div>\n            </div>\n            \n            <div class="swk-property-section">\n                <h4 class="swk-property-section-title">Transform</h4>\n                \n                <div class="swk-property-group">\n                    <label class="swk-property-label">Position</label>\n                    <div class="swk-property-vector">\n                        <input type="number" class="swk-property-input" id="prop-pos-x" value="').concat(e.position.x.toFixed(2),'" step="0.1">\n                        <input type="number" class="swk-property-input" id="prop-pos-y" value="').concat(e.position.y.toFixed(2),'" step="0.1">\n                        <input type="number" class="swk-property-input" id="prop-pos-z" value="').concat(e.position.z.toFixed(2),'" step="0.1">\n                    </div>\n                </div>\n                \n                <div class="swk-property-group">\n                    <label class="swk-property-label">Rotation ()</label>\n                    <div class="swk-property-vector">\n                        <input type="number" class="swk-property-input" id="prop-rot-x" value="').concat((180*e.rotation.x/Math.PI).toFixed(1),'" step="1">\n                        <input type="number" class="swk-property-input" id="prop-rot-y" value="').concat((180*e.rotation.y/Math.PI).toFixed(1),'" step="1">\n                        <input type="number" class="swk-property-input" id="prop-rot-z" value="').concat((180*e.rotation.z/Math.PI).toFixed(1),'" step="1">\n                    </div>\n                </div>\n                \n                <div class="swk-property-group">\n                    <label class="swk-property-label">Scale</label>\n                    <div class="swk-property-vector">\n                        <input type="number" class="swk-property-input" id="prop-scale-x" value="').concat(e.scale.x.toFixed(2),'" step="0.1" min="0.01">\n                        <input type="number" class="swk-property-input" id="prop-scale-y" value="').concat(e.scale.y.toFixed(2),'" step="0.1" min="0.01">\n                        <input type="number" class="swk-property-input" id="prop-scale-z" value="').concat(e.scale.z.toFixed(2),'" step="0.1" min="0.01">\n                    </div>\n                </div>\n            </div>\n            \n            ').concat(r?"":'\n            <div class="swk-property-section">\n                <h4 class="swk-property-section-title">Material</h4>\n                \n                <div class="swk-property-group">\n                    <label class="swk-property-label">Color</label>\n                    <input type="color" class="swk-property-input swk-property-color" id="prop-color" value="#'.concat(e.material.color.getHexString(),'">\n                </div>\n                \n                <div class="swk-property-group">\n                    <label class="swk-property-label">Visible</label>\n                    <input type="checkbox" class="swk-property-checkbox" id="prop-visible" ').concat(e.visible?"checked":"",">\n                </div>\n            </div>\n            "),"\n            \n            ").concat(t?'\n            <div class="swk-property-section">\n                <h4 class="swk-property-section-title">Text</h4>\n                \n                <div class="swk-property-group">\n                    <label class="swk-property-label">Content</label>\n                    <input type="text" class="swk-property-input" id="prop-text" value="'.concat(e.userData.text||"",'">\n                </div>\n                \n                <div class="swk-property-group">\n                    <label class="swk-property-label">Font</label>\n                    <select class="swk-property-input" id="prop-font">\n                        <option value="sans" ').concat("sans"===e.userData.fontType?"selected":"",'>Sans Serif</option>\n                        <option value="serif" ').concat("serif"===e.userData.fontType?"selected":"",'>Serif</option>\n                        <option value="mono" ').concat("mono"===e.userData.fontType?"selected":"",'>Monospace</option>\n                    </select>\n                </div>\n                \n                <div class="swk-property-group">\n                    <label class="swk-property-label">Size</label>\n                    <input type="number" class="swk-property-input" id="prop-font-size" value="').concat(e.userData.fontSize||1,'" step="0.1" min="0.1">\n                </div>\n            </div>\n            '):"","\n        "),this.attachEventListeners(e)}},{key:"showMultipleObjectsProperties",value:function(e){this.contentElement.innerHTML='\n            <div class="swk-property-section">\n                <div class="swk-property-group">\n                    <label class="swk-property-label">Selection</label>\n                    <input type="text" class="swk-property-input" readonly value="'.concat(e.length,' objects selected">\n                </div>\n            </div>\n            \n            <div class="swk-property-section">\n                <p class="swk-property-note">Multiple objects selected. Transform operations will affect all selected objects.</p>\n            </div>\n        ')}},{key:"attachEventListeners",value:function(e){var t=this,n=document.getElementById("prop-name");n&&n.addEventListener("change",function(n){e.name=n.target.value,t.emit("propertyChanged",{object:e,property:"name",value:n.target.value})}),["x","y","z"].forEach(function(n){var r=document.getElementById("prop-pos-".concat(n));r&&r.addEventListener("change",function(r){e.position[n]=parseFloat(r.target.value)||0,t.swk.captureState("Change position"),t.emit("propertyChanged",{object:e,property:"position",axis:n,value:e.position[n]})})}),["x","y","z"].forEach(function(n){var r=document.getElementById("prop-rot-".concat(n));r&&r.addEventListener("change",function(r){var o=parseFloat(r.target.value)||0;e.rotation[n]=o*Math.PI/180,t.swk.captureState("Change rotation"),t.emit("propertyChanged",{object:e,property:"rotation",axis:n,value:e.rotation[n]})})}),["x","y","z"].forEach(function(n){var r=document.getElementById("prop-scale-".concat(n));r&&r.addEventListener("change",function(r){var o=parseFloat(r.target.value)||.01;e.scale[n]=Math.max(.01,o),t.swk.captureState("Change scale"),t.emit("propertyChanged",{object:e,property:"scale",axis:n,value:e.scale[n]})})});var r=document.getElementById("prop-color");r&&e.material&&r.addEventListener("change",function(n){e.material.color.set(n.target.value),t.swk.captureState("Change color"),t.emit("propertyChanged",{object:e,property:"color",value:n.target.value})});var o=document.getElementById("prop-visible");o&&o.addEventListener("change",function(n){e.visible=n.target.checked,t.emit("propertyChanged",{object:e,property:"visible",value:e.visible})});var i=document.getElementById("prop-text");i&&i.addEventListener("change",function(n){t.updateTextGeometry(e,n.target.value,e.userData.fontSize,e.userData.fontType)});var a=document.getElementById("prop-font");a&&a.addEventListener("change",function(n){t.updateTextGeometry(e,e.userData.text,e.userData.fontSize,n.target.value)});var s=document.getElementById("prop-font-size");s&&s.addEventListener("change",function(n){var r=Math.max(.1,parseFloat(n.target.value)||1);t.updateTextGeometry(e,e.userData.text,r,e.userData.fontType)})}},{key:"updateTextGeometry",value:(a=yt().m(function e(t,n,r,o){var i;return yt().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,!(i=this.swk.shapeFactory)||"function"!=typeof i.updateTextGeometry){e.n=2;break}return e.n=1,i.updateTextGeometry(t,n,r,o);case 1:this.swk.captureState("Update text"),this.emit("propertyChanged",{object:t,property:"text"});case 2:e.n=4;break;case 3:e.p=3,e.v;case 4:return e.a(2)}},e,this,[[0,3]])}),s=function(){var e=this,t=arguments;return new Promise(function(n,r){var o=a.apply(e,t);function i(e){vt(o,n,r,i,s,"next",e)}function s(e){vt(o,n,r,i,s,"throw",e)}i(void 0)})},function(e,t,n,r){return s.apply(this,arguments)})},{key:"destroy",value:function(){this.selectedObjects=[],this.removeAllListeners()}}],o&&mt(r.prototype,o),i&&mt(r,i),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,o,i,a,s}(N);function Et(e){return Et="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Et(e)}function jt(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var c=r&&r.prototype instanceof s?r:s,u=Object.create(c.prototype);return Tt(u,"_invoke",function(n,r,o){var i,s,c,u=0,l=o||[],p=!1,f={p:0,n:0,v:e,a:h,f:h.bind(e,4),d:function(t,n){return i=t,s=0,c=e,f.n=n,a}};function h(n,r){for(s=n,c=r,t=0;!p&&u&&!o&&t<l.length;t++){var o,i=l[t],h=f.p,y=i[2];n>3?(o=y===r)&&(c=i[(s=i[4])?5:(s=3,3)],i[4]=i[5]=e):i[0]<=h&&((o=n<2&&h<i[1])?(s=0,f.v=r,f.n=i[1]):h<y&&(o=n<3||i[0]>r||r>y)&&(i[4]=n,i[5]=r,f.n=y,s=0))}if(o||n>1)return a;throw p=!0,r}return function(o,l,y){if(u>1)throw TypeError("Generator is already running");for(p&&1===l&&h(l,y),s=l,c=y;(t=s<2?e:c)||!p;){i||(s?s<3?(s>1&&(f.n=-1),h(s,c)):f.n=c:f.v=c);try{if(u=2,i){if(s||(o="next"),t=i[o]){if(!(t=t.call(i,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,s<2&&(s=0)}else 1===s&&(t=i.return)&&t.call(i),s<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),s=1);i=e}else if((t=(p=f.n<0)?c:n.call(r,f))!==a)break}catch(t){i=e,s=1,c=t}finally{u=1}}return{value:t,done:p}}}(n,o,i),!0),u}var a={};function s(){}function c(){}function u(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(Tt(t={},r,function(){return this}),t),p=u.prototype=s.prototype=Object.create(l);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,Tt(e,o,"GeneratorFunction")),e.prototype=Object.create(p),e}return c.prototype=u,Tt(p,"constructor",u),Tt(u,"constructor",c),c.displayName="GeneratorFunction",Tt(u,o,"GeneratorFunction"),Tt(p),Tt(p,o,"Generator"),Tt(p,r,function(){return this}),Tt(p,"toString",function(){return"[object Generator]"}),(jt=function(){return{w:i,m:f}})()}function Tt(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}Tt=function(e,t,n,r){function i(t,n){Tt(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(i("next",0),i("throw",1),i("return",2))},Tt(e,t,n,r)}function Ct(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function Pt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,xt(r.key),r)}}function xt(e){var t=function(e,t){if("object"!=Et(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=Et(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Et(t)?t:t+""}function Mt(e,t,n){return t=At(t),function(e,t){if(t&&("object"==Et(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Rt()?Reflect.construct(t,n||[],At(e).constructor):t.apply(e,n))}function Rt(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Rt=function(){return!!e})()}function At(e){return At=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},At(e)}function Lt(e,t){return Lt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Lt(e,t)}const Dt=function(e){function t(e,r,o){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(i=Mt(this,t)).container=e,i.swk=r,i.config=o,i.shapes=[{type:n.BOX,label:"Box",icon:""},{type:n.SPHERE,label:"Sphere",icon:""},{type:n.CYLINDER,label:"Cylinder",icon:""},{type:n.CONE,label:"Cone",icon:""},{type:n.TORUS,label:"Torus",icon:""},{type:n.PLANE,label:"Plane",icon:""},{type:n.PYRAMID,label:"Pyramid",icon:""},{type:n.TORUSKNOT,label:"Torus Knot",icon:""},{type:n.TETRAHEDRON,label:"Tetrahedron",icon:""},{type:n.OCTAHEDRON,label:"Octahedron",icon:""},{type:n.ICOSAHEDRON,label:"Icosahedron",icon:""},{type:n.DODECAHEDRON,label:"Dodecahedron",icon:""},{type:n.TEXT,label:"Text",icon:"T"}],i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Lt(e,t)}(t,e),r=t,o=[{key:"render",value:function(){var e=this;this.container.innerHTML='\n            <div class="swk-panel-header">\n                <h3>Shapes</h3>\n            </div>\n            <div class="swk-panel-content">\n                <div class="swk-shapes-grid" id="swk-shapes-grid"></div>\n            </div>\n        ';var t=document.getElementById("swk-shapes-grid");this.shapes.forEach(function(n){var r=document.createElement("button");r.className="swk-shape-button",r.setAttribute("data-shape-type",n.type),r.title=n.label,r.innerHTML='\n                <span class="swk-shape-icon">'.concat(n.icon,'</span>\n                <span class="swk-shape-label">').concat(n.label,"</span>\n            "),r.addEventListener("click",function(){return e.createShape(n.type)}),t.appendChild(r)})}},{key:"createShape",value:(a=jt().m(function e(t){var r,o,i;return jt().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,r={},t!==n.TEXT){e.n=2;break}if(o=prompt("Enter text:","Hello")){e.n=1;break}return e.a(2);case 1:r={text:o};case 2:return e.n=3,this.swk.addShape(t,r);case 3:(i=e.v)&&(this.swk.selectObject(i),this.emit("shapeCreated",{type:t,shape:i})),e.n=5;break;case 4:e.p=4,e.v;case 5:return e.a(2)}},e,this,[[0,4]])}),s=function(){var e=this,t=arguments;return new Promise(function(n,r){var o=a.apply(e,t);function i(e){Ct(o,n,r,i,s,"next",e)}function s(e){Ct(o,n,r,i,s,"throw",e)}i(void 0)})},function(e){return s.apply(this,arguments)})},{key:"refresh",value:function(){}},{key:"destroy",value:function(){this.removeAllListeners()}}],o&&Pt(r.prototype,o),i&&Pt(r,i),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,o,i,a,s}(N);function It(e){return It="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},It(e)}function Gt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Ht(r.key),r)}}function Ht(e){var t=function(e,t){if("object"!=It(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=It(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==It(t)?t:t+""}function Nt(e,t,n){return t=Ft(t),function(e,t){if(t&&("object"==It(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,_t()?Reflect.construct(t,n||[],Ft(e).constructor):t.apply(e,n))}function _t(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(_t=function(){return!!e})()}function Ft(e){return Ft=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ft(e)}function Bt(e,t){return Bt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Bt(e,t)}const Ut=function(e){function t(e,n,r){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=Nt(this,t)).container=e,o.swk=n,o.config=r,o.expandedGroups=new Set,o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Bt(e,t)}(t,e),n=t,r=[{key:"render",value:function(){var e=this;this.container.innerHTML='\n            <div class="swk-panel-header">\n                <h3>Outliner</h3>\n                <button class="swk-panel-button" id="swk-outliner-refresh" title="Refresh"></button>\n            </div>\n            <div class="swk-panel-content">\n                <div class="swk-outliner-tree" id="swk-outliner-tree"></div>\n            </div>\n        ';var t=document.getElementById("swk-outliner-refresh");t&&t.addEventListener("click",function(){return e.refresh()}),this.refresh()}},{key:"refresh",value:function(){var e=this,t=document.getElementById("swk-outliner-tree");if(t){var n=this.swk.getAllObjects();0!==n.length?(t.innerHTML="",n.filter(function(t){return!t.parent||!e.swk.isGroupContainer(t.parent)}).forEach(function(n){var r=e.createTreeItem(n);t.appendChild(r)})):t.innerHTML='\n                <div class="swk-outliner-empty">\n                    <p>No objects in scene</p>\n                    <small>Add shapes to see them here</small>\n                </div>\n            '}}},{key:"createTreeItem",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=this.swk.isGroupContainer(e),o=this.swk.selectionManager.isSelected(e),i=this.expandedGroups.has(e.userData.id),a=document.createElement("div");a.className="swk-outliner-item",a.setAttribute("data-object-id",e.userData.id),o&&a.classList.add("swk-outliner-item-selected");var s=20*n,c="";if(r?c=i?"":"":e.userData.shapeType&&(c=this.getShapeIcon(e.userData.shapeType)),a.innerHTML='\n            <div class="swk-outliner-item-content" style="padding-left: '.concat(s,'px;">\n                ').concat(r?'<span class="swk-outliner-toggle" data-object-id="'.concat(e.userData.id,'">').concat(c,"</span>"):'<span class="swk-outliner-icon">'.concat(c,"</span>"),'\n                <span class="swk-outliner-name">').concat(e.name,'</span>\n                <span class="swk-outliner-type">').concat(r?"Group":e.userData.shapeType||"","</span>\n            </div>\n        "),a.querySelector(".swk-outliner-item-content").addEventListener("click",function(n){n.target.classList.contains("swk-outliner-toggle")||t.selectObject(e)}),r){var u=a.querySelector(".swk-outliner-toggle");u&&u.addEventListener("click",function(n){n.stopPropagation(),t.toggleGroup(e)})}return r&&i&&this.swk.getGroupChildren(e).forEach(function(e){var r=t.createTreeItem(e,n+1);a.appendChild(r)}),a}},{key:"getShapeIcon",value:function(e){return{box:"",sphere:"",cylinder:"",cone:"",torus:"",plane:"",pyramid:"",torusknot:"",tetrahedron:"",octahedron:"",icosahedron:"",dodecahedron:"",text:"T"}[e]||""}},{key:"selectObject",value:function(e){this.swk.selectObject(e)}},{key:"toggleGroup",value:function(e){var t=e.userData.id;this.expandedGroups.has(t)?this.expandedGroups.delete(t):this.expandedGroups.add(t),this.refresh()}},{key:"updateSelection",value:function(e){var t=this;this.container.querySelectorAll(".swk-outliner-item-selected").forEach(function(e){return e.classList.remove("swk-outliner-item-selected")}),e.forEach(function(e){var n=t.container.querySelector('[data-object-id="'.concat(e.userData.id,'"]'));n&&n.classList.add("swk-outliner-item-selected")})}},{key:"addObject",value:function(e){this.refresh()}},{key:"removeObject",value:function(e){this.refresh()}},{key:"destroy",value:function(){this.expandedGroups.clear(),this.removeAllListeners()}}],r&&Gt(n.prototype,r),o&&Gt(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(N);function zt(e){return zt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},zt(e)}function Wt(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var c=r&&r.prototype instanceof s?r:s,u=Object.create(c.prototype);return Kt(u,"_invoke",function(n,r,o){var i,s,c,u=0,l=o||[],p=!1,f={p:0,n:0,v:e,a:h,f:h.bind(e,4),d:function(t,n){return i=t,s=0,c=e,f.n=n,a}};function h(n,r){for(s=n,c=r,t=0;!p&&u&&!o&&t<l.length;t++){var o,i=l[t],h=f.p,y=i[2];n>3?(o=y===r)&&(c=i[(s=i[4])?5:(s=3,3)],i[4]=i[5]=e):i[0]<=h&&((o=n<2&&h<i[1])?(s=0,f.v=r,f.n=i[1]):h<y&&(o=n<3||i[0]>r||r>y)&&(i[4]=n,i[5]=r,f.n=y,s=0))}if(o||n>1)return a;throw p=!0,r}return function(o,l,y){if(u>1)throw TypeError("Generator is already running");for(p&&1===l&&h(l,y),s=l,c=y;(t=s<2?e:c)||!p;){i||(s?s<3?(s>1&&(f.n=-1),h(s,c)):f.n=c:f.v=c);try{if(u=2,i){if(s||(o="next"),t=i[o]){if(!(t=t.call(i,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,s<2&&(s=0)}else 1===s&&(t=i.return)&&t.call(i),s<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),s=1);i=e}else if((t=(p=f.n<0)?c:n.call(r,f))!==a)break}catch(t){i=e,s=1,c=t}finally{u=1}}return{value:t,done:p}}}(n,o,i),!0),u}var a={};function s(){}function c(){}function u(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(Kt(t={},r,function(){return this}),t),p=u.prototype=s.prototype=Object.create(l);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,Kt(e,o,"GeneratorFunction")),e.prototype=Object.create(p),e}return c.prototype=u,Kt(p,"constructor",u),Kt(u,"constructor",c),c.displayName="GeneratorFunction",Kt(u,o,"GeneratorFunction"),Kt(p),Kt(p,o,"Generator"),Kt(p,r,function(){return this}),Kt(p,"toString",function(){return"[object Generator]"}),(Wt=function(){return{w:i,m:f}})()}function Kt(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}Kt=function(e,t,n,r){function i(t,n){Kt(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(i("next",0),i("throw",1),i("return",2))},Kt(e,t,n,r)}function Vt(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function qt(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){Vt(i,r,o,a,s,"next",e)}function s(e){Vt(i,r,o,a,s,"throw",e)}a(void 0)})}}function Xt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Yt(r.key),r)}}function Yt(e){var t=function(e,t){if("object"!=zt(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=zt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==zt(t)?t:t+""}function Qt(e,t,n){return t=Jt(t),function(e,t){if(t&&("object"==zt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,$t()?Reflect.construct(t,n||[],Jt(e).constructor):t.apply(e,n))}function $t(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return($t=function(){return!!e})()}function Jt(e){return Jt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Jt(e)}function Zt(e,t){return Zt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Zt(e,t)}const en=function(e){function t(e,n,r){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=Qt(this,t)).container=e,o.swk=n,o.config=r,o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Zt(e,t)}(t,e),n=t,r=[{key:"render",value:function(){this.container.innerHTML='\n            <div class="swk-controls-toolbar">\n                \x3c!-- Transform Modes --\x3e\n                <div class="swk-control-group">\n                    <span class="swk-control-label">Transform:</span>\n                    <div class="swk-button-group">\n                        <button class="swk-control-button active" data-mode="translate" title="Translate (T)">\n                            <span></span>\n                        </button>\n                        <button class="swk-control-button" data-mode="rotate" title="Rotate (R)">\n                            <span></span>\n                        </button>\n                        <button class="swk-control-button" data-mode="scale" title="Scale (S)">\n                            <span></span>\n                        </button>\n                    </div>\n                </div>\n                \n                \x3c!-- Camera Modes --\x3e\n                <div class="swk-control-group">\n                    <span class="swk-control-label">Camera:</span>\n                    <div class="swk-button-group">\n                        <button class="swk-control-button active" data-camera="perspective" title="Perspective">\n                            <span></span>\n                        </button>\n                        <button class="swk-control-button" data-camera="orthographic" title="Orthographic">\n                            <span></span>\n                        </button>\n                    </div>\n                </div>\n                \n                \x3c!-- Snap Settings --\x3e\n                <div class="swk-control-group">\n                    <span class="swk-control-label">Snap:</span>\n                    <select class="swk-control-select" id="swk-snap-select">\n                        <option value="0">Off</option>\n                        <option value="0.01">0.01</option>\n                        <option value="0.025">0.025</option>\n                        <option value="0.05">0.05</option>\n                        <option value="0.1" selected>0.1</option>\n                        <option value="0.2">0.2</option>\n                        <option value="0.5">0.5</option>\n                    </select>\n                </div>\n                \n                \x3c!-- History --\x3e\n                <div class="swk-control-group">\n                    <span class="swk-control-label">History:</span>\n                    <div class="swk-button-group">\n                        <button class="swk-control-button" id="swk-undo-btn" title="Undo (Ctrl+Z)" disabled>\n                            <span></span>\n                        </button>\n                        <button class="swk-control-button" id="swk-redo-btn" title="Redo (Ctrl+Y)" disabled>\n                            <span></span>\n                        </button>\n                    </div>\n                </div>\n                \n                \x3c!-- Actions --\x3e\n                <div class="swk-control-group">\n                    <span class="swk-control-label">Actions:</span>\n                    <div class="swk-button-group">\n                        <button class="swk-control-button" id="swk-group-btn" title="Group Selected">\n                            <span></span>\n                        </button>\n                        <button class="swk-control-button" id="swk-ungroup-btn" title="Ungroup">\n                            <span></span>\n                        </button>\n                        <button class="swk-control-button" id="swk-duplicate-btn" title="Duplicate">\n                            <span></span>\n                        </button>\n                        <button class="swk-control-button swk-control-button-danger" id="swk-delete-btn" title="Delete">\n                            <span></span>\n                        </button>\n                    </div>\n                </div>\n                \n                \x3c!-- Export --\x3e\n                <div class="swk-control-group">\n                    <span class="swk-control-label">Export:</span>\n                    <div class="swk-button-group">\n                        <button class="swk-control-button" id="swk-export-gltf-btn" title="Export GLTF">\n                            <span>GLTF</span>\n                        </button>\n                        <button class="swk-control-button" id="swk-export-stl-btn" title="Export STL">\n                            <span>STL</span>\n                        </button>\n                    </div>\n                </div>\n            </div>\n        ',this.attachEventListeners()}},{key:"attachEventListeners",value:function(){var e=this;this.container.querySelectorAll("[data-mode]").forEach(function(t){t.addEventListener("click",function(){var n=t.getAttribute("data-mode");e.swk.setTransformMode(n)})}),this.container.querySelectorAll("[data-camera]").forEach(function(t){t.addEventListener("click",function(){var n=t.getAttribute("data-camera");e.swk.setCameraMode(n)})});var t=document.getElementById("swk-snap-select");t&&t.addEventListener("change",function(t){var n=parseFloat(t.target.value);e.swk.setSnapUnit(n)});var n=document.getElementById("swk-undo-btn");n&&n.addEventListener("click",function(){return e.swk.undo()});var r=document.getElementById("swk-redo-btn");r&&r.addEventListener("click",function(){return e.swk.redo()});var o=document.getElementById("swk-group-btn");o&&o.addEventListener("click",function(){return e.swk.groupSelected()});var i=document.getElementById("swk-ungroup-btn");i&&i.addEventListener("click",function(){return e.swk.ungroupSelected()});var a=document.getElementById("swk-duplicate-btn");a&&a.addEventListener("click",function(){return e.swk.duplicateObject()});var s=document.getElementById("swk-delete-btn");s&&s.addEventListener("click",function(){return e.swk.deleteObject()});var c=document.getElementById("swk-export-gltf-btn");c&&c.addEventListener("click",function(){return e.exportGLTF()});var u=document.getElementById("swk-export-stl-btn");u&&u.addEventListener("click",function(){return e.exportSTL()})}},{key:"updateTransformMode",value:function(e){this.container.querySelectorAll("[data-mode]").forEach(function(t){t.getAttribute("data-mode")===e?t.classList.add("active"):t.classList.remove("active")})}},{key:"updateCameraMode",value:function(e){this.container.querySelectorAll("[data-camera]").forEach(function(t){t.getAttribute("data-camera")===e?t.classList.add("active"):t.classList.remove("active")})}},{key:"updateHistoryState",value:function(e){var t=document.getElementById("swk-undo-btn"),n=document.getElementById("swk-redo-btn");t&&(t.disabled=!e.canUndo),n&&(n.disabled=!e.canRedo)}},{key:"exportGLTF",value:(a=qt(Wt().m(function e(){return Wt().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,this.swk.exportGLTF();case 1:e.v,e.n=3;break;case 2:e.p=2,e.v;case 3:return e.a(2)}},e,this,[[0,2]])})),function(){return a.apply(this,arguments)})},{key:"exportSTL",value:(i=qt(Wt().m(function e(){return Wt().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,this.swk.exportSTL();case 1:e.v,e.n=3;break;case 2:e.p=2,e.v;case 3:return e.a(2)}},e,this,[[0,2]])})),function(){return i.apply(this,arguments)})},{key:"refresh",value:function(){this.updateTransformMode(this.swk.transformManager.getMode()),this.updateCameraMode(this.swk.cameraManager.getMode()),this.swk.historyManager&&this.updateHistoryState({canUndo:this.swk.canUndo(),canRedo:this.swk.canRedo()})}},{key:"destroy",value:function(){this.removeAllListeners()}}],r&&Xt(n.prototype,r),o&&Xt(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o,i,a}(N);function tn(e){return tn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},tn(e)}function nn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,rn(r.key),r)}}function rn(e){var t=function(e,t){if("object"!=tn(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=tn(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==tn(t)?t:t+""}function on(e,t,n){return t=sn(t),function(e,t){if(t&&("object"==tn(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,an()?Reflect.construct(t,n||[],sn(e).constructor):t.apply(e,n))}function an(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(an=function(){return!!e})()}function sn(e){return sn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},sn(e)}function cn(e,t){return cn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},cn(e,t)}const un=function(e){function t(e,n,r){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=on(this,t)).container=e,o.swk=n,o.config=r,o.propertyPanel=null,o.shapesPanel=null,o.outlinerPanel=null,o.controlsPanel=null,o.isInitialized=!1,o.uiElements={},o.uiEnabled=!1!==r.get("ui.enabled"),o.uiEnabled&&o.initialize(),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&cn(e,t)}(t,e),n=t,(r=[{key:"initialize",value:function(){if(!this.isInitialized)try{this.createUIStructure(),this.initializePanels(),this.setupEventListeners(),this.isInitialized=!0,this.emit("uiInitialized")}catch(e){}}},{key:"createUIStructure",value:function(){this.container.classList.add("swk-ui-container");var e=document.createElement("div");e.className="swk-ui-wrapper";var t=document.createElement("div");t.className="swk-sidebar swk-sidebar-left",t.innerHTML='\n            <div id="swk-shapes-panel" class="swk-panel"></div>\n            <div id="swk-property-panel" class="swk-panel"></div>\n        ';var n=document.createElement("div");n.className="swk-sidebar swk-sidebar-right",n.innerHTML='\n            <div id="swk-outliner-panel" class="swk-panel"></div>\n        ';var r=document.createElement("div");r.className="swk-toolbar swk-toolbar-bottom",r.innerHTML='\n            <div id="swk-controls-panel" class="swk-panel"></div>\n        ',e.appendChild(t),e.appendChild(n),e.appendChild(r),this.container.appendChild(e),this.uiElements={wrapper:e,leftSidebar:t,rightSidebar:n,bottomToolbar:r,shapesPanel:document.getElementById("swk-shapes-panel"),propertyPanel:document.getElementById("swk-property-panel"),outlinerPanel:document.getElementById("swk-outliner-panel"),controlsPanel:document.getElementById("swk-controls-panel")}}},{key:"initializePanels",value:function(){!1!==this.config.get("ui.panels.shapes")&&(this.shapesPanel=new Dt(this.uiElements.shapesPanel,this.swk,this.config),this.shapesPanel.render()),!1!==this.config.get("ui.panels.properties")&&(this.propertyPanel=new Ot(this.uiElements.propertyPanel,this.swk,this.config),this.propertyPanel.render()),!1!==this.config.get("ui.panels.outliner")&&(this.outlinerPanel=new Ut(this.uiElements.outlinerPanel,this.swk,this.config),this.outlinerPanel.render()),!1!==this.config.get("ui.panels.controls")&&(this.controlsPanel=new en(this.uiElements.controlsPanel,this.swk,this.config),this.controlsPanel.render())}},{key:"setupEventListeners",value:function(){var e=this;this.swk.on("selectionChanged",function(t){e.propertyPanel&&e.propertyPanel.updateSelection(t),e.outlinerPanel&&e.outlinerPanel.updateSelection(t)}),this.swk.on("objectAdded",function(t){e.outlinerPanel&&e.outlinerPanel.addObject(t)}),this.swk.on("objectRemoved",function(t){e.outlinerPanel&&e.outlinerPanel.removeObject(t),e.propertyPanel&&e.propertyPanel.updateSelection([])}),this.swk.on("transformModeChanged",function(t){e.controlsPanel&&e.controlsPanel.updateTransformMode(t)}),this.swk.on("cameraModeChanged",function(t){e.controlsPanel&&e.controlsPanel.updateCameraMode(t)}),this.swk.on("historyChanged",function(t){e.controlsPanel&&e.controlsPanel.updateHistoryState(t),e.outlinerPanel&&e.outlinerPanel.refresh()}),this.swk.on("groupCreated",function(){e.outlinerPanel&&e.outlinerPanel.refresh()}),this.swk.on("groupRemoved",function(){e.outlinerPanel&&e.outlinerPanel.refresh()})}},{key:"show",value:function(){this.uiElements.wrapper&&(this.uiElements.wrapper.style.display="")}},{key:"hide",value:function(){this.uiElements.wrapper&&(this.uiElements.wrapper.style.display="none")}},{key:"toggle",value:function(){this.uiElements.wrapper&&("none"===this.uiElements.wrapper.style.display?this.show():this.hide())}},{key:"updatePanel",value:function(e){var t=this["".concat(e,"Panel")];t&&"function"==typeof t.refresh&&t.refresh()}},{key:"destroy",value:function(){this.shapesPanel&&this.shapesPanel.destroy(),this.propertyPanel&&this.propertyPanel.destroy(),this.outlinerPanel&&this.outlinerPanel.destroy(),this.controlsPanel&&this.controlsPanel.destroy(),this.uiElements.wrapper&&this.uiElements.wrapper.parentNode&&this.uiElements.wrapper.parentNode.removeChild(this.uiElements.wrapper),this.uiElements={},this.propertyPanel=null,this.shapesPanel=null,this.outlinerPanel=null,this.controlsPanel=null,this.removeAllListeners(),this.isInitialized=!1}}])&&nn(n.prototype,r),o&&nn(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(N);function ln(e){return ln="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ln(e)}function pn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function fn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?pn(Object(n),!0).forEach(function(t){hn(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pn(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function hn(e,t,n){return(t=gn(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function yn(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var c=r&&r.prototype instanceof s?r:s,u=Object.create(c.prototype);return dn(u,"_invoke",function(n,r,o){var i,s,c,u=0,l=o||[],p=!1,f={p:0,n:0,v:e,a:h,f:h.bind(e,4),d:function(t,n){return i=t,s=0,c=e,f.n=n,a}};function h(n,r){for(s=n,c=r,t=0;!p&&u&&!o&&t<l.length;t++){var o,i=l[t],h=f.p,y=i[2];n>3?(o=y===r)&&(c=i[(s=i[4])?5:(s=3,3)],i[4]=i[5]=e):i[0]<=h&&((o=n<2&&h<i[1])?(s=0,f.v=r,f.n=i[1]):h<y&&(o=n<3||i[0]>r||r>y)&&(i[4]=n,i[5]=r,f.n=y,s=0))}if(o||n>1)return a;throw p=!0,r}return function(o,l,y){if(u>1)throw TypeError("Generator is already running");for(p&&1===l&&h(l,y),s=l,c=y;(t=s<2?e:c)||!p;){i||(s?s<3?(s>1&&(f.n=-1),h(s,c)):f.n=c:f.v=c);try{if(u=2,i){if(s||(o="next"),t=i[o]){if(!(t=t.call(i,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,s<2&&(s=0)}else 1===s&&(t=i.return)&&t.call(i),s<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),s=1);i=e}else if((t=(p=f.n<0)?c:n.call(r,f))!==a)break}catch(t){i=e,s=1,c=t}finally{u=1}}return{value:t,done:p}}}(n,o,i),!0),u}var a={};function s(){}function c(){}function u(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(dn(t={},r,function(){return this}),t),p=u.prototype=s.prototype=Object.create(l);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,dn(e,o,"GeneratorFunction")),e.prototype=Object.create(p),e}return c.prototype=u,dn(p,"constructor",u),dn(u,"constructor",c),c.displayName="GeneratorFunction",dn(u,o,"GeneratorFunction"),dn(p),dn(p,o,"Generator"),dn(p,r,function(){return this}),dn(p,"toString",function(){return"[object Generator]"}),(yn=function(){return{w:i,m:f}})()}function dn(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}dn=function(e,t,n,r){function i(t,n){dn(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(i("next",0),i("throw",1),i("return",2))},dn(e,t,n,r)}function vn(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function mn(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){vn(i,r,o,a,s,"next",e)}function s(e){vn(i,r,o,a,s,"throw",e)}a(void 0)})}}function bn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,gn(r.key),r)}}function gn(e){var t=function(e,t){if("object"!=ln(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=ln(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==ln(t)?t:t+""}function wn(e,t,n){return t=Sn(t),function(e,t){if(t&&("object"==ln(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,kn()?Reflect.construct(t,n||[],Sn(e).constructor):t.apply(e,n))}function kn(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(kn=function(){return!!e})()}function Sn(e){return Sn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Sn(e)}function On(e,t){return On=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},On(e,t)}const En=function(e){function t(e,n,r){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=wn(this,t)).scene=e,o.swk=n,o.config=r,o.hasGLTFExporter="undefined"!=typeof THREE&&THREE.GLTFExporter,o.hasSTLExporter="undefined"!=typeof THREE&&THREE.STLExporter,o.hasGLTFExporter,o.hasSTLExporter,o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&On(e,t)}(t,e),n=t,r=[{key:"prepareSceneForExport",value:function(){var e=[];return this.scene.children.forEach(function(t){t.userData&&t.userData.isShape&&e.push(t)}),e}},{key:"createExportScene",value:function(){var e=new THREE.Scene;return this.prepareSceneForExport().forEach(function(t){var n=t.clone();e.add(n)}),e}},{key:"exportGLTF",value:(s=mn(yn().m(function e(){var t,n,r,o,i,a,s,c,u=this,l=arguments;return yn().w(function(e){for(;;)switch(e.p=e.n){case 0:if(t=l.length>0&&void 0!==l[0]?l[0]:{},this.hasGLTFExporter){e.n=1;break}return this.emit("exportError",{format:"gltf",error:"GLTFExporter not found"}),e.a(2,!1);case 1:if(n=void 0!==t.binary&&t.binary,r=t.filename||"scene-".concat(S()),o=n?"glb":"gltf",e.p=2,this.emit("exportStart",{format:o}),0!==(i=this.createExportScene()).children.length){e.n=3;break}return this.emit("exportError",{format:o,error:"No objects to export"}),e.a(2,!1);case 3:return a=new THREE.GLTFExporter,s={binary:n,embedImages:!0,truncateDrawRange:!1,onlyVisible:!0,maxTextureSize:4096},e.a(2,new Promise(function(e){a.parse(i,function(t){try{if(n)k(new Blob([t],{type:"application/octet-stream"}),"".concat(r,".").concat(o));else{var a=JSON.stringify(t,null,2);k(new Blob([a],{type:"application/json"}),"".concat(r,".").concat(o))}u.emit("exportComplete",{format:o,filename:"".concat(r,".").concat(o),objectCount:i.children.length}),e(!0)}catch(t){u.emit("exportError",{format:o,error:t.message}),e(!1)}},function(t){u.emit("exportError",{format:o,error:t.message}),e(!1)},s)}));case 4:return e.p=4,c=e.v,this.emit("exportError",{format:o,error:c.message}),e.a(2,!1)}},e,this,[[2,4]])})),function(){return s.apply(this,arguments)})},{key:"exportSTL",value:(a=mn(yn().m(function e(){var t,n,r,o,i,a,s,c,u=arguments;return yn().w(function(e){for(;;)switch(e.p=e.n){case 0:if(t=u.length>0&&void 0!==u[0]?u[0]:{},this.hasSTLExporter){e.n=1;break}return this.emit("exportError",{format:"stl",error:"STLExporter not found"}),e.a(2,!1);case 1:if(n=void 0===t.binary||t.binary,r=t.filename||"scene-".concat(S()),e.p=2,this.emit("exportStart",{format:"stl"}),0!==(o=this.prepareSceneForExport()).length){e.n=3;break}return this.emit("exportError",{format:"stl",error:"No objects to export"}),e.a(2,!1);case 3:return i=new THREE.STLExporter,a=new THREE.Group,o.forEach(function(e){a.add(e.clone())}),s=i.parse(a,{binary:n}),k(n?new Blob([s],{type:"application/octet-stream"}):new Blob([s],{type:"text/plain"}),"".concat(r,".stl")),this.emit("exportComplete",{format:"stl",filename:"".concat(r,".stl"),objectCount:o.length,binary:n}),e.a(2,!0);case 4:return e.p=4,c=e.v,this.emit("exportError",{format:"stl",error:c.message}),e.a(2,!1)}},e,this,[[2,4]])})),function(){return a.apply(this,arguments)})},{key:"exportSelected",value:(i=mn(yn().m(function e(){var t,n,r,o,i,a,s=arguments;return yn().w(function(e){for(;;)switch(e.n){case 0:if(t=s.length>0&&void 0!==s[0]?s[0]:"gltf",n=s.length>1&&void 0!==s[1]?s[1]:{},0!==(r=this.swk.getSelectedObjects()).length){e.n=1;break}return this.emit("exportError",{format:t,error:"No objects selected"}),e.a(2,!1);case 1:if(o=new THREE.Scene,r.forEach(function(e){o.add(e.clone())}),i=this.scene,this.scene=o,"glb"!==t){e.n=3;break}return e.n=2,this.exportGLTF(fn(fn({},n),{},{binary:!0}));case 2:a=e.v,e.n=8;break;case 3:if("gltf"!==t){e.n=5;break}return e.n=4,this.exportGLTF(fn(fn({},n),{},{binary:!1}));case 4:a=e.v,e.n=8;break;case 5:if("stl"!==t){e.n=7;break}return e.n=6,this.exportSTL(n);case 6:a=e.v,e.n=8;break;case 7:a=!1;case 8:return this.scene=i,e.a(2,a)}},e,this)})),function(){return i.apply(this,arguments)})},{key:"getAvailableFormats",value:function(){var e=[];return this.hasGLTFExporter&&e.push({format:"gltf",name:"GLTF (JSON)",extension:"gltf",binary:!1},{format:"glb",name:"GLB (Binary)",extension:"glb",binary:!0}),this.hasSTLExporter&&e.push({format:"stl",name:"STL",extension:"stl",binary:!0}),e}},{key:"isFormatAvailable",value:function(e){return this.getAvailableFormats().some(function(t){return t.format===e})}},{key:"dispose",value:function(){this.removeAllListeners()}}],r&&bn(n.prototype,r),o&&bn(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o,i,a,s}(N);function jn(e){return jn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},jn(e)}function Tn(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var c=r&&r.prototype instanceof s?r:s,u=Object.create(c.prototype);return Cn(u,"_invoke",function(n,r,o){var i,s,c,u=0,l=o||[],p=!1,f={p:0,n:0,v:e,a:h,f:h.bind(e,4),d:function(t,n){return i=t,s=0,c=e,f.n=n,a}};function h(n,r){for(s=n,c=r,t=0;!p&&u&&!o&&t<l.length;t++){var o,i=l[t],h=f.p,y=i[2];n>3?(o=y===r)&&(c=i[(s=i[4])?5:(s=3,3)],i[4]=i[5]=e):i[0]<=h&&((o=n<2&&h<i[1])?(s=0,f.v=r,f.n=i[1]):h<y&&(o=n<3||i[0]>r||r>y)&&(i[4]=n,i[5]=r,f.n=y,s=0))}if(o||n>1)return a;throw p=!0,r}return function(o,l,y){if(u>1)throw TypeError("Generator is already running");for(p&&1===l&&h(l,y),s=l,c=y;(t=s<2?e:c)||!p;){i||(s?s<3?(s>1&&(f.n=-1),h(s,c)):f.n=c:f.v=c);try{if(u=2,i){if(s||(o="next"),t=i[o]){if(!(t=t.call(i,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,s<2&&(s=0)}else 1===s&&(t=i.return)&&t.call(i),s<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),s=1);i=e}else if((t=(p=f.n<0)?c:n.call(r,f))!==a)break}catch(t){i=e,s=1,c=t}finally{u=1}}return{value:t,done:p}}}(n,o,i),!0),u}var a={};function s(){}function c(){}function u(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(Cn(t={},r,function(){return this}),t),p=u.prototype=s.prototype=Object.create(l);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,Cn(e,o,"GeneratorFunction")),e.prototype=Object.create(p),e}return c.prototype=u,Cn(p,"constructor",u),Cn(u,"constructor",c),c.displayName="GeneratorFunction",Cn(u,o,"GeneratorFunction"),Cn(p),Cn(p,o,"Generator"),Cn(p,r,function(){return this}),Cn(p,"toString",function(){return"[object Generator]"}),(Tn=function(){return{w:i,m:f}})()}function Cn(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}Cn=function(e,t,n,r){function i(t,n){Cn(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(i("next",0),i("throw",1),i("return",2))},Cn(e,t,n,r)}function Pn(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function xn(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){Pn(i,r,o,a,s,"next",e)}function s(e){Pn(i,r,o,a,s,"throw",e)}a(void 0)})}}function Mn(e){return function(e){if(Array.isArray(e))return Rn(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return Rn(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Rn(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Rn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function An(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Ln(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?An(Object(n),!0).forEach(function(t){Dn(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):An(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Dn(e,t,n){return(t=Gn(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function In(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Gn(r.key),r)}}function Gn(e){var t=function(e,t){if("object"!=jn(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=jn(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==jn(t)?t:t+""}function Hn(e,t,n){return t=_n(t),function(e,t){if(t&&("object"==jn(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Nn()?Reflect.construct(t,n||[],_n(e).constructor):t.apply(e,n))}function Nn(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Nn=function(){return!!e})()}function _n(e){return _n=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},_n(e)}function Fn(e,t){return Fn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Fn(e,t)}var Bn=function(e){function t(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=Hn(this,t);var o=U.fromAPI(e,r),i=o.container,a=o.config;return n.config=new D(Ln({container:i},a)),n.container=i,n.renderer=null,n.sceneManager=null,n.cameraManager=null,n.lighting=null,n.shapeFactory=null,n.picker=null,n.selectionManager=null,n.outliner=null,n.transformManager=null,n.snapManager=null,n.groupManager=null,n.historyManager=null,n.uiManager=null,n.exportManager=null,n.objects=[],n.selectedObject=null,n.selectedObjects=[],n.groups=[],n.initialized=!1,n.animationId=null,n.init(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Fn(e,t)}(t,e),n=t,r=[{key:"init",value:function(){var e=this;if(!this.initialized)try{this.setupContainer(),this.renderer=new Q(this.container,this.config),this.sceneManager=new V(this.config),this.cameraManager=new ne(this.container,this.config),this.lighting=new ce(this.sceneManager.getScene(),this.config),this.shapeFactory=new me(this.config),this.picker=new ke(this.cameraManager.getCamera(),this.renderer.getRenderer()),this.selectionManager=new Ce(this),this.outliner=new Ie(this.sceneManager.getScene(),this.config),this.transformManager=new _e(this.cameraManager.getCamera(),this.renderer.getCanvas(),this.sceneManager.getScene(),this.config,this),this.snapManager=new Ke(this.transformManager.getControls(),this.config,this),this.groupManager=new $e(this.sceneManager.getScene(),this,this.config),this.config.get("history.enabled")&&(this.historyManager=new ft(this.sceneManager.getScene(),this.selectionManager,this.groupManager,this.shapeFactory,{get:function(t){return"maxHistory"===t?e.config.get("history.maxSize"):e.config.get(t)}}),this.historyManager.on("stateChanged",function(t){e.emit("historyChanged",t)}),this.historyManager.on("stateRestored",function(t){e.emit("historyRestored",t),e.updateSelectionOutlines()})),this.transformControls=this.transformManager.getControls(),this.config.get("ui.enabled")&&(this.uiManager=new un(this.container,this,this.config)),this.config.get("features.export")&&(this.exportManager=new En(this.sceneManager.getScene(),this,this.config),this.exportManager.on("exportStart",function(t){e.emit("exportStart",t)}),this.exportManager.on("exportComplete",function(t){e.emit("exportComplete",t)}),this.exportManager.on("exportError",function(t){e.emit("exportError",t)})),this.shapeFactory.loadFonts(function(){}),this.setupControls(),this.setupEventListeners(),this.on("orbitControlsEnabled",function(t){e.controls&&(e.controls.enabled=t)}),this.animate(),this.initialized=!0,this.emit("initialized")}catch(e){throw e}}},{key:"setupContainer",value:function(){this.container.style.position="relative",this.container.style.width=this.config.get("width"),this.container.style.height=this.config.get("height"),this.container.style.overflow="hidden"}},{key:"setupControls",value:function(){var e=this.cameraManager.getCamera(),t=this.renderer.getCanvas();this.controls=new THREE.OrbitControls(e,t),this.controls.enableDamping=!0,this.controls.dampingFactor=.05,this.controls.screenSpacePanning=!1,this.controls.minDistance=1,this.controls.maxDistance=100,this.controls.maxPolarAngle=Math.PI/2,this.cameraManager.setControls(this.controls)}},{key:"setupEventListeners",value:function(){var e=this;this.renderer.getCanvas().addEventListener("click",this.onCanvasClick.bind(this)),window.addEventListener("keydown",this.onKeyDown.bind(this));var t=!1;this.on("transformDragging",function(n){!n&&t?(e.captureState("Transform object"),t=!1):n&&(t=!0)})}},{key:"onCanvasClick",value:function(e){if(!this.transformControls||!this.transformControls.dragging){var t=this.renderer.getCanvas(),n=this.picker.pickFromEvent(e,t,this.objects,!1);if(n){var r=n.object;e.ctrlKey||e.metaKey?this.selectionManager.toggle(r):this.selectionManager.select(r),1===this.selectionManager.getSelectionCount()?this.transformControls.attach(r):this.transformControls.detach(),this.updateSelectionOutlines()}else this.deselectAll();this.emit("canvasClick",{mouse:this.picker.getMousePosition(),event:e,intersection:n})}}},{key:"onKeyDown",value:function(e){var t=this;if(e.ctrlKey||e.metaKey){if("z"===e.key.toLowerCase())return e.shiftKey?this.redo():this.undo(),void e.preventDefault();if("y"===e.key.toLowerCase())return this.redo(),void e.preventDefault()}if(!e.ctrlKey&&!e.metaKey&&!e.altKey)switch(e.key.toLowerCase()){case"t":this.setTransformMode("translate"),e.preventDefault();break;case"r":this.setTransformMode("rotate"),e.preventDefault();break;case"s":this.setTransformMode("scale"),e.preventDefault();break;case"delete":case"backspace":this.selectionManager.getSelectedObjects().forEach(function(e){return t.deleteObject(e)}),e.preventDefault()}this.emit("keydown",e)}},{key:"animate",value:function(){this.animationId=requestAnimationFrame(this.animate.bind(this)),this.controls&&this.controls.update(),this.outliner&&this.outliner.syncOutlines();var e=this.sceneManager.getScene(),t=this.cameraManager.getCamera();this.renderer.render(e,t),this.emit("render")}},{key:"getScene",value:function(){return this.sceneManager?this.sceneManager.getScene():null}},{key:"getRenderer",value:function(){return this.renderer?this.renderer.getRenderer():null}},{key:"getCamera",value:function(){return this.cameraManager?this.cameraManager.getCamera():null}},{key:"setCameraMode",value:function(e){this.cameraManager&&(this.cameraManager.setMode(e),this.transformManager&&this.transformManager.setCamera(this.cameraManager.getCamera()),this.picker&&this.picker.setCamera(this.cameraManager.getCamera()),this.emit("cameraModeChanged",e))}},{key:"getCameraMode",value:function(){return this.cameraManager?this.cameraManager.getMode():null}},{key:"setBackground",value:function(e){this.renderer&&(this.renderer.setBackgroundColor(e),this.emit("backgroundChanged",e))}},{key:"resetCamera",value:function(){this.cameraManager&&(this.cameraManager.reset(),this.emit("cameraReset"))}},{key:"addShape",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.shapeFactory.createShape(e,t);if(!n)return null;this.sceneManager.add(n),this.objects.push(n),this.emit("objectAdded",n);var r=this.config.get("callbacks.onObjectAdded");return r&&"function"==typeof r&&r(n),this.captureState("Add ".concat(n.name)),n}},{key:"deleteObject",value:function(e){if(!e)return!1;this.sceneManager.remove(e);var t=this.objects.indexOf(e);t>-1&&this.objects.splice(t,1),this.selectedObject===e&&this.deselectAll();var n=this.selectedObjects.indexOf(e);n>-1&&this.selectedObjects.splice(n,1),e.geometry&&e.geometry.dispose(),e.material&&(Array.isArray(e.material)?e.material.forEach(function(e){return e.dispose()}):e.material.dispose()),this.emit("objectRemoved",e);var r=this.config.get("callbacks.onObjectRemoved");return r&&"function"==typeof r&&r(e),this.captureState("Delete ".concat(e.name)),!0}},{key:"duplicateObject",value:function(e){if(!e)return null;var t=e.userData.shapeType,n={color:e.userData.color};"text"===t&&(n.text=e.userData.textContent,n.font=e.userData.textFont,n.height=e.userData.textHeight,n.bevel=e.userData.textBevel);var r=this.shapeFactory.createShape(t,n);return r?(r.position.copy(e.position),r.position.x+=.5,r.rotation.copy(e.rotation),r.scale.copy(e.scale),this.sceneManager.add(r),this.objects.push(r),this.emit("objectAdded",r),this.captureState("Duplicate ".concat(e.name)),r):null}},{key:"getAllObjects",value:function(){var e=this,t=this.sceneManager.getScene(),n=[];return t.children.forEach(function(t){if(t.userData&&t.userData.isUserObject)if(e.groupManager.isGroupContainer(t)){var r=e.groupManager.getGroupChildren(t);n.push.apply(n,Mn(r))}else n.push(t)}),n}},{key:"selectObject",value:function(e){e&&(this.selectionManager.select(e),this.updateSelectionOutlines(),this.transformControls&&this.transformControls.attach(e))}},{key:"deselectAll",value:function(){this.selectionManager.clear(),this.updateSelectionOutlines(),this.transformControls&&this.transformControls.detach()}},{key:"updateSelectionOutlines",value:function(){this.outliner.clearAllOutlines();var e=this.selectionManager.getSelectedObjects();e.length>0&&this.outliner.createOutlines(e),this.selectedObjects=e,this.selectedObject=this.selectionManager.getSelectedObject();var t=this.config.get("callbacks.onSelectionChanged");t&&"function"==typeof t&&t(e,[])}},{key:"getSelectedObjects",value:function(){return Mn(this.selectedObjects)}},{key:"getSelectedObject",value:function(){return this.selectedObject}},{key:"setTransformMode",value:function(e){this.transformManager&&this.transformManager.setMode(e)}},{key:"getTransformMode",value:function(){return this.transformManager?this.transformManager.getMode():null}},{key:"setTransformSpace",value:function(e){this.transformManager&&this.transformManager.setSpace(e)}},{key:"getTransformSpace",value:function(){return this.transformManager?this.transformManager.getSpace():null}},{key:"setSnapUnit",value:function(e){this.snapManager&&this.snapManager.setSnapUnit(e)}},{key:"getSnapUnit",value:function(){return this.snapManager?this.snapManager.getSnapUnit():0}},{key:"toggleSnap",value:function(){this.snapManager&&this.snapManager.toggleSnap()}},{key:"groupSelected",value:function(){if(!this.groupManager)return null;var e=this.selectionManager.getSelectedObjects();if(e.length<1)return null;this.outliner.removeOutlines(e);var t=this.groupManager.createGroup(e);return t&&(this.deselectAll(),this.selectObject(t),this.groups=this.groupManager.getAllGroups(),this.captureState("Create group ".concat(t.name))),t}},{key:"ungroupSelected",value:function(){if(!this.groupManager)return null;var e=this.selectionManager.getSelectedObject();if(!e||!this.groupManager.isGroupContainer(e))return null;var t=this.groupManager.ungroup(e);return t&&t.length>0&&(this.deselectAll(),this.groups=this.groupManager.getAllGroups(),this.captureState("Ungroup ".concat(e.name))),t}},{key:"isGrouped",value:function(e){return!!this.groupManager&&this.groupManager.isGrouped(e)}},{key:"isGroupContainer",value:function(e){return!!this.groupManager&&this.groupManager.isGroupContainer(e)}},{key:"getAllGroups",value:function(){return this.groupManager?this.groupManager.getAllGroups():[]}},{key:"getGroupChildren",value:function(e){return this.groupManager?this.groupManager.getGroupChildren(e):[]}},{key:"captureState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Action";return!!this.historyManager&&this.historyManager.captureState(e)}},{key:"undo",value:function(){if(this.historyManager){var e=this.historyManager.undo();return e&&(this.objects=this.getAllObjects(),this.groups=this.getAllGroups()),e}return!1}},{key:"redo",value:function(){if(this.historyManager){var e=this.historyManager.redo();return e&&(this.objects=this.getAllObjects(),this.groups=this.getAllGroups()),e}return!1}},{key:"canUndo",value:function(){return!!this.historyManager&&this.historyManager.canUndo()}},{key:"canRedo",value:function(){return!!this.historyManager&&this.historyManager.canRedo()}},{key:"getHistoryStats",value:function(){return this.historyManager?this.historyManager.getStats():null}},{key:"clearHistory",value:function(){this.historyManager&&this.historyManager.clear()}},{key:"exportGLTF",value:(c=xn(Tn().m(function e(){var t,n=arguments;return Tn().w(function(e){for(;;)switch(e.n){case 0:if(t=n.length>0&&void 0!==n[0]?n[0]:{},this.exportManager){e.n=1;break}return e.a(2,!1);case 1:return e.n=2,this.exportManager.exportGLTF(Ln(Ln({},t),{},{binary:!1}));case 2:return e.a(2,e.v)}},e,this)})),function(){return c.apply(this,arguments)})},{key:"exportGLB",value:(s=xn(Tn().m(function e(){var t,n=arguments;return Tn().w(function(e){for(;;)switch(e.n){case 0:if(t=n.length>0&&void 0!==n[0]?n[0]:{},this.exportManager){e.n=1;break}return e.a(2,!1);case 1:return e.n=2,this.exportManager.exportGLTF(Ln(Ln({},t),{},{binary:!0}));case 2:return e.a(2,e.v)}},e,this)})),function(){return s.apply(this,arguments)})},{key:"exportSTL",value:(a=xn(Tn().m(function e(){var t,n=arguments;return Tn().w(function(e){for(;;)switch(e.n){case 0:if(t=n.length>0&&void 0!==n[0]?n[0]:{},this.exportManager){e.n=1;break}return e.a(2,!1);case 1:return e.n=2,this.exportManager.exportSTL(t);case 2:return e.a(2,e.v)}},e,this)})),function(){return a.apply(this,arguments)})},{key:"exportSelected",value:(i=xn(Tn().m(function e(){var t,n,r=arguments;return Tn().w(function(e){for(;;)switch(e.n){case 0:if(t=r.length>0&&void 0!==r[0]?r[0]:"gltf",n=r.length>1&&void 0!==r[1]?r[1]:{},this.exportManager){e.n=1;break}return e.a(2,!1);case 1:return e.n=2,this.exportManager.exportSelected(t,n);case 2:return e.a(2,e.v)}},e,this)})),function(){return i.apply(this,arguments)})},{key:"getAvailableExportFormats",value:function(){return this.exportManager?this.exportManager.getAvailableFormats():[]}},{key:"destroy",value:function(){this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null);var e=this.renderer?this.renderer.getCanvas():null;e&&e.removeEventListener("click",this.onCanvasClick.bind(this)),window.removeEventListener("keydown",this.onKeyDown.bind(this)),this.uiManager&&this.uiManager.destroy(),this.exportManager&&this.exportManager.dispose(),this.groupManager&&this.groupManager.clearAllGroups(),this.historyManager&&this.historyManager.dispose(),this.transformManager&&this.transformManager.dispose(),this.outliner&&this.outliner.dispose(),this.lighting&&this.lighting.dispose(),this.cameraManager&&this.cameraManager.dispose(),this.sceneManager&&this.sceneManager.dispose(),this.renderer&&this.renderer.dispose(),this.renderer=null,this.sceneManager=null,this.cameraManager=null,this.lighting=null,this.shapeFactory=null,this.picker=null,this.selectionManager=null,this.outliner=null,this.transformManager=null,this.snapManager=null,this.groupManager=null,this.historyManager=null,this.uiManager=null,this.exportManager=null,this.controls=null,this.transformControls=null,this.objects=[],this.selectedObjects=[],this.selectedObject=null,this.groups=[],this.removeAllListeners(),this.initialized=!1}}],r&&In(n.prototype,r),o&&In(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o,i,a,s,c}(N);"undefined"!=typeof window&&("loading"===document.readyState?document.addEventListener("DOMContentLoaded",function(){Bn.autoInit=function(){return U.autoInit(Bn)}}):Bn.autoInit=function(){return U.autoInit(Bn)});const Un=Bn;return"undefined"!=typeof window&&(window.SWK=Bn),t=t.default})());
//# sourceMappingURL=swk.min.js.map